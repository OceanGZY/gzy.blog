<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>åŸºäºPyTorchå®ç°å›¾åƒå»æ¨¡ç³Š-å­¦ä¹  | OCAEN.GZYè¯»ä¹¦åŸå—</title><meta name="author" content="OCEAN.GZY"><meta name="copyright" content="OCEAN.GZY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="## åŸºäºPyTorchå®ç°å›¾åƒå»æ¨¡ç³Š-å­¦ä¹   ## ä»»åŠ¡æè¿°  - ç›¸æœºçš„æŠ–åŠ¨ã€å¿«é€Ÿè¿åŠ¨çš„ç‰©ä½“éƒ½ä¼šå¯¼è‡´æ‹æ‘„å‡ºæ¨¡ç³Šçš„å›¾åƒï¼Œæ™¯æ·±å˜åŒ–ä¹Ÿä¼šä½¿å›¾åƒè¿›ä¸€æ­¥æ¨¡ç³Šã€‚ - å¯¹äºä¼ ç»Ÿæ–¹æ³•æ¥è¯´ï¼Œè¦æƒ³ä¼°è®¡å‡ºæ¯ä¸ªåƒç´ ç‚¹å¯¹åº”çš„ â€œblur kernelâ€ å‡ ä¹æ˜¯ä¸å¯è¡Œçš„ã€‚å› æ­¤ï¼Œä¼ ç»Ÿæ–¹æ³•å¸¸å¸¸éœ€è¦å¯¹æ¨¡ç³Šæºä½œå‡ºå‡è®¾ï¼Œå°† â€œblur kernelâ€ å‚æ•°åŒ–ã€‚æ˜¾ç„¶ï¼Œè¿™ç±»æ–¹æ³•ä¸è¶³ä»¥è§£å†³å®é™…ä¸­å„ç§å¤æ‚å› ç´ å¼•èµ·çš„å›¾åƒæ¨¡ç³Šã€‚ - å·ç§¯ç¥">
<meta property="og:type" content="article">
<meta property="og:title" content="åŸºäºPyTorchå®ç°å›¾åƒå»æ¨¡ç³Š-å­¦ä¹ ">
<meta property="og:url" content="http://oceaneyes.top/2021/11/19/pytorch%E5%9B%BE%E5%83%8F%E5%8E%BB%E6%A8%A1%E7%B3%8A/index.html">
<meta property="og:site_name" content="OCAEN.GZYè¯»ä¹¦åŸå—">
<meta property="og:description" content="## åŸºäºPyTorchå®ç°å›¾åƒå»æ¨¡ç³Š-å­¦ä¹   ## ä»»åŠ¡æè¿°  - ç›¸æœºçš„æŠ–åŠ¨ã€å¿«é€Ÿè¿åŠ¨çš„ç‰©ä½“éƒ½ä¼šå¯¼è‡´æ‹æ‘„å‡ºæ¨¡ç³Šçš„å›¾åƒï¼Œæ™¯æ·±å˜åŒ–ä¹Ÿä¼šä½¿å›¾åƒè¿›ä¸€æ­¥æ¨¡ç³Šã€‚ - å¯¹äºä¼ ç»Ÿæ–¹æ³•æ¥è¯´ï¼Œè¦æƒ³ä¼°è®¡å‡ºæ¯ä¸ªåƒç´ ç‚¹å¯¹åº”çš„ â€œblur kernelâ€ å‡ ä¹æ˜¯ä¸å¯è¡Œçš„ã€‚å› æ­¤ï¼Œä¼ ç»Ÿæ–¹æ³•å¸¸å¸¸éœ€è¦å¯¹æ¨¡ç³Šæºä½œå‡ºå‡è®¾ï¼Œå°† â€œblur kernelâ€ å‚æ•°åŒ–ã€‚æ˜¾ç„¶ï¼Œè¿™ç±»æ–¹æ³•ä¸è¶³ä»¥è§£å†³å®é™…ä¸­å„ç§å¤æ‚å› ç´ å¼•èµ·çš„å›¾åƒæ¨¡ç³Šã€‚ - å·ç§¯ç¥">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2021-11-19T15:19:00.000Z">
<meta property="article:modified_time" content="2022-09-30T06:56:37.182Z">
<meta property="article:author" content="OCEAN.GZY">
<meta property="article:tag" content="Machine Learning">
<meta property="article:tag" content="Algorithm">
<meta property="article:tag" content="PyTorch">
<meta property="article:tag" content="CV">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://oceaneyes.top/2021/11/19/pytorch%E5%9B%BE%E5%83%8F%E5%8E%BB%E6%A8%A1%E7%B3%8A/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'åŸºäºPyTorchå®ç°å›¾åƒå»æ¨¡ç³Š-å­¦ä¹ ',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-09-30 14:56:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">166</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">114</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">91</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="OCAEN.GZYè¯»ä¹¦åŸå—"><span class="site-name">OCAEN.GZYè¯»ä¹¦åŸå—</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">åŸºäºPyTorchå®ç°å›¾åƒå»æ¨¡ç³Š-å­¦ä¹ </h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-11-19T15:19:00.000Z" title="å‘è¡¨äº 2021-11-19 23:19:00">2021-11-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-09-30T06:56:37.182Z" title="æ›´æ–°äº 2022-09-30 14:56:37">2022-09-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Artificial-Intelligence/">Artificial Intelligence</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Artificial-Intelligence/Machine-Learning/">Machine Learning</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Artificial-Intelligence/Machine-Learning/Algorithm/">Algorithm</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Artificial-Intelligence/Machine-Learning/Algorithm/CV/">CV</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="åŸºäºPyTorchå®ç°å›¾åƒå»æ¨¡ç³Š-å­¦ä¹ "><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container">
## åŸºäºPyTorchå®ç°å›¾åƒå»æ¨¡ç³Š-å­¦ä¹ 

## ä»»åŠ¡æè¿°

- ç›¸æœºçš„æŠ–åŠ¨ã€å¿«é€Ÿè¿åŠ¨çš„ç‰©ä½“éƒ½ä¼šå¯¼è‡´æ‹æ‘„å‡ºæ¨¡ç³Šçš„å›¾åƒï¼Œæ™¯æ·±å˜åŒ–ä¹Ÿä¼šä½¿å›¾åƒè¿›ä¸€æ­¥æ¨¡ç³Šã€‚
- å¯¹äºä¼ ç»Ÿæ–¹æ³•æ¥è¯´ï¼Œè¦æƒ³ä¼°è®¡å‡ºæ¯ä¸ªåƒç´ ç‚¹å¯¹åº”çš„ â€œblur kernelâ€ å‡ ä¹æ˜¯ä¸å¯è¡Œçš„ã€‚å› æ­¤ï¼Œä¼ ç»Ÿæ–¹æ³•å¸¸å¸¸éœ€è¦å¯¹æ¨¡ç³Šæºä½œå‡ºå‡è®¾ï¼Œå°† â€œblur kernelâ€ å‚æ•°åŒ–ã€‚æ˜¾ç„¶ï¼Œè¿™ç±»æ–¹æ³•ä¸è¶³ä»¥è§£å†³å®é™…ä¸­å„ç§å¤æ‚å› ç´ å¼•èµ·çš„å›¾åƒæ¨¡ç³Šã€‚
- å·ç§¯ç¥ç»ç½‘ç»œèƒ½å¤Ÿä»å›¾åƒä¸­æå–å‡ºå¤æ‚çš„ç‰¹å¾ï¼Œä»è€Œä½¿å¾—æ¨¡å‹èƒ½å¤Ÿé€‚åº”å„ç§åœºæ™¯ã€‚  
- æœ¬æ•™ç¨‹ä»¥ CVPR2017 çš„ ã€ŠDeep Multi-scale Convolutional Neural Network for Dynamic Scene Deblurringã€‹ ä¸ºä¾‹ï¼Œæ¥å®Œæˆå›¾åƒå»æ¨¡ç³Šçš„ä»»åŠ¡ã€‚

### æ–¹æ³•æ¦‚è¿°

- åˆ©ç”¨pytorchæ·±åº¦å­¦ä¹ å·¥å…·å®ç°ä¸€ä¸ªç«¯åˆ°ç«¯çš„å›¾åƒå»æ¨¡ç³Šæ¨¡å‹ï¼Œé€šè¿‡å‚æ•°è®¾ç½®ã€åŠ è½½æ•°æ®ã€æ„å»ºæ¨¡å‹ã€è®­ç»ƒæ¨¡å‹å’Œæµ‹è¯•ç”¨ä¾‹ä¾æ¬¡å®ç°ä¸€ä¸ªå›¾åƒå»æ¨¡ç³Šå·¥å…·ï¼Œåœ¨è®­ç»ƒå’Œé¢„å¤„ç†è¿‡ç¨‹ä¸­é€šè¿‡å¯è§†åŒ–ç›‘ç£è®­ç»ƒè¿‡ç¨‹ã€‚ 
- æ¨¡å‹é‡‡ç”¨äº†æ®‹å·®å½¢å¼çš„CNNï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½é‡‡ç”¨é«˜æ–¯é‡‘å­—å¡”ï¼ˆGaussian pyramidï¼‰çš„å½¢å¼ã€‚
- æ•´ä¸ªç½‘ç»œç»“æ„ç”±ä¸‰ä¸ªç›¸ä¼¼çš„CNNæ„æˆï¼Œåˆ†åˆ«å¯¹åº”è¾“å…¥é‡‘å­—å¡”ä¸­çš„æ¯ä¸€å±‚ã€‚ç½‘ç»œæœ€å‰é¢æ˜¯åˆ†è¾¨ç‡æœ€ä½çš„å­ç½‘ç»œï¼ˆcoarest level networkï¼‰ï¼Œåœ¨è¿™ä¸ªå­ç½‘ç»œæœ€åï¼Œæ˜¯â€œupconvolution layerâ€ï¼Œå°†é‡å»ºçš„ä½åˆ†è¾¨ç‡å›¾åƒæ”¾å¤§ä¸ºé«˜åˆ†è¾¨ç‡å›¾åƒï¼Œç„¶åå’Œé«˜ä¸€å±‚çš„å­ç½‘ç»œçš„è¾“å…¥è¿æ¥åœ¨ä¸€èµ·ï¼Œä½œä¸ºä¸Šå±‚ç½‘ç»œçš„è¾“å…¥ã€‚

![image-20211120221821489](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211120221821489.png)


```python
%config Completer.use_jedi = False
```


```python
#!pip install pytorch_msssim -i https://pypi.tuna.tsinghua.edu.cn/simple
# !jupyter nbextension enable --py widgetsnbextension
```


```python
import torch

import numpy as np

import os
import random
import matplotlib.pyplot as plt
import torch.nn as nn
import torch.optim as optim
from PIL import Image
from tensorboardX import SummaryWriter
from torchsummary import summary
from torch.optim import lr_scheduler
from torch.utils import data
from torchvision import transforms
from tqdm.notebook import tqdm


import pytorch_msssim # ç”¨äºè®¡ç®—æŒ‡æ ‡ ssim å’Œ mssim

device = torch.device("cuda:0" if torch.cuda.is_available() else "cpu")
```

## å‚æ•°è®¾ç½®


```python
class Config():
    def __init__(self,name="Configs"):
        # train set
        self.data_dir = 'datasets/train' # è®­ç»ƒé›†ç›®å½•
        self.patch_size = 256  # è¾“å…¥æ¨¡å‹çš„patchçš„å°ºå¯¸
        self.batch_size= 2 #16 # è®­ç»ƒæ—¶æ¯ä¸ªbatchä¸­çš„æ ·æœ¬ä¸ªæ•°
        self.n_threads = 1 # ç”¨äºåŠ è½½æ•°æ®çš„çº¿ç¨‹æ•°
        
        # test set
        self.test_data_dir = 'datasets/test' # æµ‹è¯•é›†ç›®å½•
        self.test_batch_size=1 # æµ‹è¯•æ—¶çš„ batch_size
        
        # model
        self.multi = True # æ¨¡å‹é‡‡ç”¨å¤šå°ºåº¦æ–¹æ³•True
        self.skip = True # æ¨¡å‹é‡‡ç”¨æ»‘åŠ¨è¿æ¥æ–¹æ³•
        self.n_resblocks = 3 #9  # resblockçš„ä¸ªæ•°
        self.n_feats = 8 #64  #feature mapçš„ä¸ªæ•°
        
        # optimization 
        self.lr = 1e-4  # åˆå§‹å­¦ä¹ ç‡
        self.epochs =5 #800 # è®­ç»ƒepochçš„æ•°ç›®
        self.lr_step_size = 600 #é‡‡ç”¨æ­¥è¿›å­¦ä¹ ç‡ç­–ç•¥æ‰€ç”¨çš„ step_size
        self.lr_gamma = 0.1 #æ¯ lr_step_sizeåï¼Œå­¦ä¹ ç‡å˜æˆ lr * lr_gamma
        
        # global
        self.name = name #é…ç½®çš„åç§°
        self.save_dir = 'temp/result'  # ä¿å­˜è®­ç»ƒè¿‡ç¨‹ä¸­æ‰€äº§ç”Ÿæ•°æ®çš„ç›®å½•
        self.save_cp_dir = 'temp/models'  # ä¿å­˜ checkpointçš„ç›®å½•
        self.imgs_dir = 'datasets/pictures'  # æ­¤ notebookæ‰€éœ€çš„å›¾ç‰‡ç›®å½•
        
        
        if not os.path.exists(self.save_dir):
            os.makedirs(self.save_dir)
        if not os.path.exists(self.save_cp_dir):
            os.makedirs(self.save_cp_dir)
#         if not os.path.exists(self.data_dir):
#             os.makedirs(self.data_dir)
#         if not os.path.exists(self.test_data_dir):
#             os.makedirs(self.test_data_dir)

args =  Config(name="image-deblurring")
```

## æ•°æ®å‡†å¤‡

- æ•°æ®é›†å±•ç¤º
- æ•°æ®å¢å¼º
- æ„é€  datasetç±»
- æ•°æ®åŠ è½½ dataloader

### æ•°æ®é›†å±•ç¤º


```python
sample_idx = 1 # æ ·æœ¬ç¼–å·
blur_path = os.path.join(args.imgs_dir,f"blur/test{sample_idx}.png")  # æ¨¡ç³Šå›¾ç‰‡
sharp_path = os.path.join(args.imgs_dir,f"sharp/test{sample_idx}.png") # å»æ¨¡ç³Šå›¾ç‰‡
blur_img = plt.imread(blur_path)
sharp_img = plt.imread(sharp_path)
```


```python
plt.figure(figsize=(10,4))
plt.subplot(121)
plt.imshow(blur_img)
plt.subplot(122)
plt.imshow(sharp_img)
plt.show()
```


![image-20211120221933618](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211120221933618.png)  


### æ•°æ®å¢å¼º

ä¸ºäº†é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œéœ€è¦å¯¹æ•°æ®é›†è¿›è¡Œæ•°æ®å¢å¼ºï¼Œå¢å¼ºæ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼Œå¯¹æ¯ä¸€ä¸ªè¾“å…¥å›¾åƒï¼Œéƒ½å°†å…¶è¿›è¡Œéšæœºè§’åº¦æ—‹è½¬ï¼Œæ—‹è½¬çš„è§’åº¦åœ¨ [0, 90, 180, 270] ä¸­éšæœºé€‰å–ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè€ƒè™‘åˆ°å›¾åƒè´¨é‡ä¸‹é™ï¼Œå¯¹ HSV é¢œè‰²ç©ºé—´çš„é¥±å’Œåº¦ä¹˜ä»¥ 0.8 åˆ° 1.2 å†…çš„éšæœºæ•°


```python
def augment(img_input, img_target):
    degree = random.choice([0,90,180,270])
    img_input = transforms.functional.rotate(img_input,degree)
    img_target = transforms.functional.rotate(img_target,degree)
    
    # color augmentation
    img_input = transforms.functional.adjust_gamma(img_input,1)
    img_target = transforms.functional.adjust_gamma(img_target,1)
    sat_factor = 1 + (0.2 - 0.4* np.random.rand())
    img_input = transforms.functional.adjust_saturation(img_input,sat_factor)
    img_target = transforms.functional.adjust_saturation(img_target,sat_factor)
    
    return img_input,img_target
```


```python
img_input = Image.open(blur_path)
img_target = Image.open(sharp_path)

img_aug_input,img_aug_target = augment(img_input,img_target)
```


```python
plt.figure(figsize=(10,5))
plt.subplot(121)
plt.imshow(img_aug_input)
plt.subplot(122)
plt.imshow(img_aug_target)
plt.show()
```


![image-20211120221955392](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211120221955392.png)


### æ„é€  datasetç±»

å¯¹æ¯ä¸€ä¸ªè¾“å…¥å›¾åƒï¼Œå¯¹é½è¿›è¡Œéšæœºè£å‰ªï¼Œå¾—åˆ°patch_sizeå¤§å°çš„è¾“å…¥


```python
def getPatch(img_input,img_target,patch_size):
    w,h = img_input.size
    p = patch_size
    x = random.randrange(0,w-p +1)
    y = random.randrange(0,h -p +1)
    
    img_input = img_input.crop((x,y,x+p,y+p))
    img_target = img_target.crop((x,y,x+p,y+p))
    
    return img_input,img_target
```


```python
class ImgMission(data.Dataset):
    def __init__(self,data_dir, patch_size=256, is_train= False, multi=True):
        super(ImgMission,self).__init__()
        
        self.is_train = is_train  #æ˜¯å¦æ˜¯è®­ç»ƒé›†
        self.patch_size = patch_size # è®­ç»ƒæ—¶ patchçš„å°ºå¯¸
        self.multi = multi  # æ˜¯å¦é‡‡ç”¨å¤šå°ºåº¦å› å­ï¼Œé»˜è®¤é‡‡ç”¨
        
        self.sharp_file_paths = []
        sub_folders = os.listdir(data_dir)
        print(sub_folders)
        
        for folder_name in sub_folders:
            sharp_sub_folder = os.path.join(data_dir,folder_name,'sharp')
            sharp_file_names = os.listdir(sharp_sub_folder)
            # print(sharp_file_names)
            for file_name in sharp_file_names:
                sharp_file_path = os.path.join(sharp_sub_folder,file_name)
                # print(sharp_file_path)
                self.sharp_file_paths.append(sharp_file_path)
                
        self.n_samples = len(self.sharp_file_paths)
        
    def get_img_pair(self,idx):
        sharp_file_path = self.sharp_file_paths[idx]
        blur_file_path = sharp_file_path.replace("sharp","blur")
        # print(blur_file_path)
        img_input = Image.open(blur_file_path).convert('RGB')
        img_target = Image.open(sharp_file_path).convert('RGB')
        
        return img_input,img_target
    
    def __getitem__(self,idx):
        img_input,img_target = self.get_img_pair(idx)
        
        if self.is_train:
            img_input,img_target = getPatch(img_input,img_target, self.patch_size)
            img_input,img_target=  augment(img_input,img_target)
            
            
        # è½¬æ¢ä¸º tensorç±»å‹
        input_b1 = transforms.ToTensor()(img_input)
        target_s1 = transforms.ToTensor()(img_target)
        
        H = input_b1.size()[1]
        W= input_b1.size()[2]
        
        if self.multi:
            input_b1 = transforms.ToPILImage()(input_b1)
            target_s1 = transforms.ToPILImage()(target_s1)
            
            input_b2 = transforms.ToTensor()(transforms.Resize([int(H/2), int(W/2)])(input_b1))
            input_b3 = transforms.ToTensor()(transforms.Resize([int(H/4), int(W/4)])(input_b1))
            
            # åªå¯¹è®­ç»ƒé›†è¿›è¡Œæ•°æ®å¢å¼º
            if self.is_train:
                target_s2 = transforms.ToTensor()(transforms.Resize([int(H/2), int(W/2)])(target_s1))
                target_s3 = transforms.ToTensor()(transforms.Resize([int(H/4), int(W/4)])(target_s1))
            else:
                target_s2 = []
                target_s3 = []
                
            input_b1 = transforms.ToTensor()(input_b1)
            target_s1 = transforms.ToTensor()(target_s1)
            
            return {
                'input_b1': input_b1, # å‚ç…§ä¸‹æ–‡çš„ç½‘ç»œç»“æ„ï¼Œè¾“å…¥å›¾åƒçš„å°ºåº¦ 1
                'input_b2': input_b2, # è¾“å…¥å›¾åƒçš„å°ºåº¦ 2
                'input_b3': input_b3, # è¾“å…¥å›¾åƒçš„å°ºåº¦ 3
                'target_s1': target_s1, # ç›®æ ‡å›¾åƒçš„å°ºåº¦ 1
                'target_s2': target_s2, # ç›®æ ‡å›¾åƒçš„å°ºåº¦ 2
                'target_s3': target_s3 # ç›®æ ‡å›¾åƒçš„å°ºåº¦ 3
            }
        else:
            return {'input_b1': input_b1, 'target_s1': target_s1}
            
        
        
    def __len__(self):
        return self.n_samples
```

### æ•°æ®åŠ è½½ dataloader


```python
def get_dataset(data_dir,patch_size=None, 
                batch_size=1, n_threads=1, 
                is_train=False,multi=False):
    # Datasetå®ä¾‹åŒ–
    
#     print(data_dir)
#     print(patch_size)
#     print(is_train)
#     print(multi)

    dataset = ImgMission(data_dir,patch_size=patch_size,
                    is_train=is_train,multi=multi)
    
    # print(dataset)
    # åˆ©ç”¨å°è£…å¥½çš„ dataloader æ¥å£å®šä¹‰è®­ç»ƒè¿‡ç¨‹çš„è¿­ä»£å™¨
    # å‚æ•°num_workersè¡¨ç¤ºè¿›ç¨‹ä¸ªæ•°ï¼Œåœ¨jupyterä¸‹æ”¹ä¸º0
    dataloader = torch.utils.data.DataLoader(dataset,batch_size=batch_size,
                                            drop_last=True, shuffle=is_train,
                                             num_workers = 0)
    return dataloader
```

- å°†è®­ç»ƒæ—¶çš„dataloaderå®ä¾‹åŒ–


```python
data_loader = get_dataset(args.data_dir,
                          patch_size=args.patch_size,
                          batch_size= args.batch_size,
                          n_threads= args.n_threads,
                          is_train=True,
                          multi = args.multi
                         )
```

    ['GOPR0372_07_00', 'GOPR0372_07_01', 'GOPR0374_11_00', 'GOPR0374_11_01', 'GOPR0374_11_02', 'GOPR0374_11_03', 'GOPR0378_13_00', 'GOPR0379_11_00', 'GOPR0380_11_00', 'GOPR0384_11_01', 'GOPR0384_11_02', 'GOPR0384_11_03', 'GOPR0384_11_04', 'GOPR0385_11_00', 'GOPR0386_11_00', 'GOPR0477_11_00', 'GOPR0857_11_00', 'GOPR0868_11_01', 'GOPR0868_11_02', 'GOPR0871_11_01', 'GOPR0881_11_00', 'GOPR0884_11_00']


## æ¨¡å‹æ„å»º

- æ¨¡å‹ä»‹ç»
- æ¨¡å‹å®šä¹‰
- å®ä¾‹åŒ–æ¨¡å‹
- æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨

![image-20211120222025823](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211120222025823.png)

CONV è¡¨ç¤ºå·ç§¯å±‚ï¼Œ
ResBlock è¡¨ç¤ºæ®‹å·®æ¨¡å—ï¼Œ
Upconv è¡¨ç¤ºä¸Šé‡‡æ ·ï¼ˆä¹Ÿå¯ä»¥ç”¨åå·ç§¯ä»£æ›¿ï¼‰ã€‚
ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ¨¡å‹ä½¿ç”¨äº† â€œmulti-scaleâ€ çš„ç»“æ„ï¼Œ
åœ¨è¾“å…¥å’Œè¾“å‡ºéƒ¨åˆ†éƒ½éƒ½é‡‡ç”¨äº†é«˜æ–¯é‡‘å­—å¡”ï¼ˆGaussian pyramidï¼‰çš„å½¢å¼ï¼ˆå³å¯¹åŸå›¾åƒè¿›è¡Œä¸åŒå°ºåº¦çš„ä¸‹é‡‡æ ·ï¼Œä»è€Œè·å¾—å¤„äºä¸åŒåˆ†è¾¨ç‡çš„å›¾åƒï¼‰

![image-20211120222042862](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211120222042862.png)

### æ¨¡å‹å®šä¹‰

- default_conv æ˜¯æ¨¡å‹é‡‡ç”¨çš„é»˜è®¤å·ç§¯å±‚ï¼Œ
- UpConv ç”¨äºä¸Šé‡‡æ ·å·ç§¯ï¼Œ
- ResidualBlock æ˜¯æ¨¡å‹ä½¿ç”¨çš„æ®‹å·®æ¨¡å—ï¼Œ
- SingleScaleNet æ˜¯å•ä¸ªå°ºåº¦ç½‘ç»œï¼Œ
- MultiScaleNet å°†å‡ ä¸ª SingleScaleNet æ•´åˆæˆäº†æœ€ç»ˆçš„å¤šå°ºåº¦ç½‘ç»œæ¨¡å‹

*å…·ä½“ä½œç”¨*

- default_conv : ç½‘ç»œä¸­é»˜è®¤é‡‡ç”¨çš„å·ç§¯å±‚ï¼Œå®šä¹‰ä¹‹åï¼Œé¿å…é‡å¤ä»£ç 
- UpConv : ä¸Šå·ç§¯ï¼Œå¯¹åº”ä¸Šå›¾ä¸­çš„ Up Convï¼Œå°†å›¾åƒçš„å°ºåº¦æ‰©å¤§ï¼Œè¾“å…¥åˆ°å¦ä¸€ä¸ªå•å°ºåº¦ç½‘ç»œ
- ResidualBlock : æ®‹å·®æ¨¡å—ï¼Œç½‘ç»œæ¨¡å‹ä¸­é‡‡ç”¨çš„æ®‹å·®æ¨¡å—ï¼Œä¹‹æ‰€ä»¥é‡‡ç”¨æ®‹å·®æ¨¡å—ï¼Œæ˜¯å› ä¸ºç½‘ç»œâ€œåªéœ€è¦éœ€è¦æ¨¡ç³Šå›¾åƒä¸å»æ¨¡ç³Šå›¾åƒä¹‹é—´çš„å·®å¼‚å³å¯â€
- SingleScaleNet : å•å°ºåº¦æ¨¡å‹ï¼Œä¸€ä¸ªå°ºåº¦å¯¹åº”ä¸€ä¸ªå•å°ºåº¦æ¨¡å‹å®ä¾‹
- MultiScaleNet : å¤šå°ºåº¦æ¨¡å‹ï¼Œå°†å¤šä¸ªå•å°ºåº¦æ¨¡å‹å®ä¾‹ç»„åˆå³å¯å¾—åˆ°ä¸Šå›¾æ‰€ç¤ºçš„å¤šå°ºåº¦å»æ¨¡ç³Šç½‘ç»œ


```python
def default_conv(in_channels,out_channels, kernel_size, bias):
    return nn.Conv2d(in_channels,
                    out_channels,
                    kernel_size,
                    padding=(kernel_size // 2),
                    bias=bias)

class UpConv(nn.Module):
    def __init__(self):
        super(UpConv, self).__init__()
        self.body = nn.Sequential(default_conv(3,12,3,True),
                                 nn.PixelShuffle(2),
                                 nn.ReLU(inplace=True))
    def forward(self,x):
            return self.body(x)

class ResidualBlock(nn.Module):
    def __init__(self,n_feats):
        super(ResidualBlock,self).__init__()
        
        modules_body = [
            default_conv(n_feats, n_feats, 3, bias=True),
            nn.ReLU(inplace=True),
            default_conv(n_feats,n_feats,3,bias=True)
        ]
        
        self.body = nn.Sequential(*modules_body)
        
    def forward(self,x):
        res= self.body(x)
        res += x
        return res

class SingleScaleNet(nn.Module):
    def __init__(self,n_feats,n_resblocks, is_skip, n_channels=3):
        super(SingleScaleNet, self).__init__()
        self.is_skip = is_skip
        
        modules_head = [
            default_conv(n_channels,n_feats,5,bias=True),
            nn.ReLU(inplace=True)
        ]
        
        modules_body = [ResidualBlock(n_feats) for _ in range(n_resblocks)]
        modules_tail = [default_conv(n_feats, 3,5,bias=True)]
        
        self.head = nn.Sequential(*modules_head)
        self.body = nn.Sequential(*modules_body)
        self.tail = nn.Sequential(*modules_tail)
        
    def forward(self,x):
        x= self.head(x)
        res= self.body(x)
        if self.is_skip:
            res += x
        
        res = self.tail(res)
        return res

class MultiScaleNet(nn.Module):
    def __init__(self,n_feats, n_resblocks ,is_skip):
        super(MultiScaleNet,self).__init__()
        
        self.scale3_net = SingleScaleNet(n_feats,
                                         n_resblocks,
                                         is_skip,
                                         n_channels=3)
        self.upconv3 = UpConv()
        self.scale2_net = SingleScaleNet(n_feats,
                                         n_resblocks,
                                         is_skip,
                                         n_channels=6)
        self.upconv2 = UpConv()
        
        self.scale1_net = SingleScaleNet(n_feats,
                                        n_resblocks,
                                        is_skip,
                                        n_channels=6)
        
    def forward(self,mulscale_input):
        input_b1, input_b2,input_b3 = mulscale_input
        
        output_l3 = self.scale3_net(input_b3)
        output_l3_up = self.upconv3(output_l3)
        
        output_l2 = self.scale2_net(torch.cat((input_b2,output_l3_up),1))
        output_l2_up = self.upconv2(output_l2)
        
        output_l1 = self.scale2_net(torch.cat((input_b1,output_l2_up),1))
        
        return output_l1,output_l2,output_l3
```

### æ¨¡å‹å®ä¾‹åŒ–


```python
if args.multi:
    my_model = MultiScaleNet(n_feats=args.n_feats,
                            n_resblocks = args.n_resblocks,
                            is_skip= args.skip)
else:
    my_model = SingleScaleNet(n_feats=args.n_feats,
                             n_resblocks=args.n_resblocks,
                             is_skip = args.skip)
```


```python
if torch.cuda.is_available():
    my_model.cuda()
    loss_function = nn.MSELoss().cuda()
else:
    loss_function = nn.MSELoss()
    
optimizer = optim.Adam(my_model.parameters(),lr=args.lr)
print(my_model)
print(loss_function)
```

    MultiScaleNet(
      (scale3_net): SingleScaleNet(
        (head): Sequential(
          (0): Conv2d(3, 8, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
          (1): ReLU(inplace=True)
        )
        (body): Sequential(
          (0): ResidualBlock(
            (body): Sequential(
              (0): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
              (1): ReLU(inplace=True)
              (2): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
            )
          )
          (1): ResidualBlock(
            (body): Sequential(
              (0): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
              (1): ReLU(inplace=True)
              (2): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
            )
          )
          (2): ResidualBlock(
            (body): Sequential(
              (0): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
              (1): ReLU(inplace=True)
              (2): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
            )
          )
        )
        (tail): Sequential(
          (0): Conv2d(8, 3, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
        )
      )
      (upconv3): UpConv(
        (body): Sequential(
          (0): Conv2d(3, 12, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
          (1): PixelShuffle(upscale_factor=2)
          (2): ReLU(inplace=True)
        )
      )
      (scale2_net): SingleScaleNet(
        (head): Sequential(
          (0): Conv2d(6, 8, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
          (1): ReLU(inplace=True)
        )
        (body): Sequential(
          (0): ResidualBlock(
            (body): Sequential(
              (0): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
              (1): ReLU(inplace=True)
              (2): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
            )
          )
          (1): ResidualBlock(
            (body): Sequential(
              (0): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
              (1): ReLU(inplace=True)
              (2): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
            )
          )
          (2): ResidualBlock(
            (body): Sequential(
              (0): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
              (1): ReLU(inplace=True)
              (2): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
            )
          )
        )
        (tail): Sequential(
          (0): Conv2d(8, 3, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
        )
      )
      (upconv2): UpConv(
        (body): Sequential(
          (0): Conv2d(3, 12, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
          (1): PixelShuffle(upscale_factor=2)
          (2): ReLU(inplace=True)
        )
      )
      (scale1_net): SingleScaleNet(
        (head): Sequential(
          (0): Conv2d(6, 8, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
          (1): ReLU(inplace=True)
        )
        (body): Sequential(
          (0): ResidualBlock(
            (body): Sequential(
              (0): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
              (1): ReLU(inplace=True)
              (2): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
            )
          )
          (1): ResidualBlock(
            (body): Sequential(
              (0): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
              (1): ReLU(inplace=True)
              (2): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
            )
          )
          (2): ResidualBlock(
            (body): Sequential(
              (0): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
              (1): ReLU(inplace=True)
              (2): Conv2d(8, 8, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))
            )
          )
        )
        (tail): Sequential(
          (0): Conv2d(8, 3, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))
        )
      )
    )
    MSELoss()


### æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨

- Adam ä¼˜åŒ–å™¨ï¼Œåˆå§‹å­¦ä¹ ç‡ä¸º lrï¼Œå…¶ç›¸å¯¹äº SGDï¼Œæ›´è‡ªåŠ¨åŒ–ï¼Œå®é™…ä¸­éœ€è¦è°ƒæ•´çš„å‚æ•°è¾ƒå°‘ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¶ä½¿ç”¨å†…å­˜ä¹Ÿæ¯” SGD è¦é«˜ã€‚
- æŸå¤±å‡½æ•°ä½¿ç”¨æœ€å¸¸è§çš„å‡æ–¹æŸå¤±å‡½æ•°ï¼ˆMSELossï¼‰:
  ![image-20211120222105417](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211120222105417.png)
  å…¶ä¸­ $f^{\prime}(i,j)$  å’Œ  $f(i,j)$  åˆ†åˆ«ä¸ºæ¨¡å‹è¾“å‡ºç»“æœå›¾å’Œéæ¨¡ç³Šå›¾ä¸Šåæ ‡ä¸º  $(i,j)$  çš„åƒç´ ï¼ŒM,Nåˆ†åˆ«è¡¨ç¤ºå›¾ç‰‡çš„é•¿ä¸å®½ã€‚
- å…·ä½“çš„ï¼Œæœ¬æ–‡æ‰€ç”¨çš„å¤šå°ºåº¦æŸå¤±å‡½æ•°ä¸ºï¼š
  ![image-20211120222124809](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211120222124809.png)
  $f^{\prime}_k$ å’Œ  $f_k$ åˆ†åˆ«è¡¨ç¤ºç¬¬  $k$  ä¸ªå°ºåº¦ä¸Šçš„è¾“å‡ºç»“æœå›¾å’Œéæ¨¡ç³Šå›¾ã€‚

## æ¨¡å‹è®­ç»ƒ

1) è®­ç»ƒç­–ç•¥
2) è®­ç»ƒæ¨¡å‹
3) è®­ç»ƒè¿‡ç¨‹å¯è§†åŒ–

### è®­ç»ƒç­–ç•¥

- åœ¨æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œéšç€è®­ç»ƒçš„è¿›è¡Œï¼Œæ›´æ–°ç½‘ç»œå‚æ•°çš„æ­¥è¿›ï¼ˆå­¦ä¹ ç‡ï¼‰åº”è¯¥è¶Šæ¥è¶Šå°ï¼Œæ•´ä½“è®­ç»ƒè¿‡ç¨‹åº”è¯¥æ»¡è¶³ â€œå…ˆç²—è°ƒåç»†è°ƒâ€ï¼Œè¿™å°±æ˜¯å¸¸è¯´çš„å­¦ä¹ ç‡ç­–ç•¥ã€‚
- æœ¬æ¬¡è®­ç»ƒé‡‡ç”¨çš„å­¦ä¹ ç‡ä¼˜åŒ–ç­–ç•¥ä¸º lr_scheduler.StepLRï¼Œæ­¥è¿›ä¸º lr_step_sizeï¼Œå­¦ä¹ ç‡æ¯éš” lr_step_size ä¸ª epoch ä¹˜ä»¥ lr_gamma


```python
scheduler = lr_scheduler.StepLR(optimizer,args.lr_step_size,args.lr_gamma)

scheduler
```




    <torch.optim.lr_scheduler.StepLR at 0x290378a0198>



### è®­ç»ƒæ¨¡å‹

åœ¨è®­ç»ƒå¼€å§‹ä¹‹å‰ï¼Œè¦å…ˆåˆ›å»ºä¸€ä¸ª SummaryWriterï¼Œç”¨æ¥è®°å½•å’Œå¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹


```python
writer = SummaryWriter(os.path.join(args.save_dir,"temp/logs/"))

writer
```




    <tensorboardX.writer.SummaryWriter at 0x290378d6e10>



- åœ¨å‘½ä»¤è¡Œè¿è¡Œ tensorboard --logdir=experiment/logs æ¥å¯åŠ¨tensorboardã€‚
- åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œæ¯è®­ç»ƒå®Œä¸€ä¸ª epoch å°†æ¨¡å‹çš„å‚æ•°ä¿å­˜ä¸‹æ¥ï¼Œé˜²æ­¢è®­ç»ƒè¢«æ„å¤–ä¸­æ–­ä»¥åŠæ–¹ä¾¿æµ‹è¯•ï¼Œå¦‚æœéœ€è¦ä¸æ–­æ›´æ–°æœ€æ–°çš„ä¸€æ¬¡è®­ç»ƒçš„å‚æ•°ï¼Œå¯ä»¥å–æ¶ˆæœ€åä¸€è¡Œçš„æ³¨é‡Šã€‚
- è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ tqdm çš„è¿›åº¦æ¡æ¥è§‚å¯Ÿè®­ç»ƒè¿‡ç¨‹


```python
bar_format = '{desc}{percentage:3.0f}% | [{elapsed}<{remaining},{rate_fmt}]' 3 8 10 # è¿›åº¦æ¡æ ¼å¼ for epoch in range(args.epochs): total_loss="0" batch_bar="tqdm(data_loader," bar_format="bar_format)" åˆ©ç”¨tqdmåŠ¨æ€æ˜¾ç¤ºè®­ç»ƒè¿‡ç¨‹ batch,images enumerate(batch_bar): my_model.train() curr_batch="epoch" * data_loader.__len__() + batch å½“å‰batchåœ¨æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­çš„ç´¢å¼• input_b1="images['input_b1'].to(device)" åŸå§‹è¾“å…¥å›¾åƒ target_s1="images['target_s1'].to(device)" ç›®æ ‡éæ¨¡ç³Šå›¾ç‰‡ if args.multi: input_b2="images['input_b2'].to(device)" level-2 å°ºåº¦ target_s2="images['target_s2'].to(device)" input_b3="images['input_b3'].to(device)" level-3 target_s3="images['target_s3'].to(device)" output_l1, output_l2, output_l3="my_model((input_b1,input_b2,input_b3))" æŸå¤±å‡½æ•° loss="(loss_function(output_l1,target_s1)" loss_function(output_l2,target_s2) loss_function(output_l3, target_s3)) else: output_l1="my_model(input_b1)" my_model.zero_grad() loss.backward() #åå‘ä¼ æ’­ optimizer.step() æ›´æ–°æƒå€¼ print_str="|" .join([ "epoch:%3d %3d" % (epoch 1, args.epochs), "batch:%3d (batch data_loader.__len__()), "loss:%.5f" (loss.item()), ]) batch_bar.set_description(print_str,refresh="True)" æ›´æ–°è¿›åº¦æ¡ writer.add_scalar('train batch_loss', loss.item(), curr_batch) batch_bar.close() scheduler.step() #è°ƒæ•´å­¦ä¹ ç‡ +1) batch_loss',loss,epoch) torch.save(my_model.state_dict(),os.path.join(args.save_cp_dir, f'epoch_{epoch}.pt')) ä¿å­˜æ¯ä¸ª çš„å‚æ•° f'epoch_lastest.pt')) ä¿å­˜æœ€æ–°çš„å‚æ•° ``` ![image-20211120222241087](c:\users\administrator\appdata\roaming\typora\typora-user-images\image-20211120222241087.png) ## æ¨¡å‹è¯„ä¼° 1) æŒ‡æ ‡ä»‹ç» 2) æŒ‡æ ‡å®ç° ### ä¸ºäº†è¯„ä¼°æ¨¡å‹çš„æ•ˆæœå¦‚ä½•ï¼Œæˆ‘ä»¬é€šè¿‡è®¡ç®— å³°å€¼ä¿¡å™ªæ¯”ï¼ˆpeak signal-to-noise ratio, psnrï¼‰ï¼Œ ç»“æ„ç›¸ä¼¼æ€§ï¼ˆstructural similarity, ssimï¼‰å’Œ å¤šå°ºåº¦çš„ ssimï¼ˆmulti-scale ssimï¼Œmssimï¼‰ä¸‰ä¸ªæŒ‡æ ‡æ¥å¯¹ç»“æœè¿›è¡Œåˆ†æ ##### psnr çš„å®šä¹‰å¦‚ä¸‹ï¼š ![image-20211120222352850](c:\users\administrator\appdata\roaming\typora\typora-user-images\image-20211120222352850.png) å…¶ä¸­ï¼Œ$m a x_{i}$è¡¨ç¤ºå›¾åƒç‚¹é¢œè‰²çš„æœ€å¤§æ•°å€¼ï¼Œå¦‚æœæ¯ä¸ªé‡‡æ ·ç‚¹ç”¨ ä½è¡¨ç¤ºï¼Œåˆ™æœ€å¤§æ•°å€¼ä¸º 255ï¼Œ$mse$æ˜¯ä¸¤ä¸ªå›¾åƒä¹‹é—´çš„å‡æ–¹è¯¯å·®ã€‚ psnrå€¼è¶Šå¤§ä»£è¡¨æ¨¡ç³Šå›¾åƒä¸å‚è€ƒå›¾åƒè¶Šæ¥è¿‘ï¼Œå³å»æ¨¡ç³Šæ•ˆæœè¶Šå¥½ã€‚ ssim ssimä¹Ÿæ˜¯è¡¡é‡ä¸¤å¹…å›¾ç‰‡ç›¸ä¼¼æ€§çš„æŒ‡æ ‡ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š ![image-20211120222344621](c:\users\administrator\appdata\roaming\typora\typora-user-images\image-20211120222344621.png) ssimç”±æ¨¡å‹è¾“å‡ºå›¾åƒ $x$ å’Œå‚è€ƒå›¾åƒ $y$ ä¹‹é—´çš„äº®åº¦å¯¹æ¯”ï¼ˆ$ l(\mathbf{x}, \mathbf{y})$ï¼‰ã€å¯¹æ¯”åº¦å¯¹æ¯”ï¼ˆ$c(\mathbf{x}, \mathbf{y})$ï¼‰å’Œç»“æ„å¯¹æ¯”ï¼ˆ$s(\mathbf{x}, \mathbf{y}) $ï¼‰ä¸‰éƒ¨åˆ†ç»„æˆï¼Œ$\alpha$ï¼Œ$\beta$ å’Œ $\gamma$æ˜¯å„è‡ªçš„æƒé‡å› å­ï¼Œä¸€èˆ¬éƒ½å–ä¸º 1ï¼š ![image-20211120222325752](c:\users\administrator\appdata\roaming\typora\typora-user-images\image-20211120222325752.png) å…¶ä¸­ï¼Œ$c_{1}$ï¼Œ$c_{2}$å’Œ$c_{3}$ä¸ºå¸¸æ•°ï¼Œæ˜¯ä¸ºäº†é¿å…åˆ†æ¯æ¥è¿‘äº0æ—¶é€ æˆçš„ä¸ç¨³å®šæ€§ã€‚$\mu_{x}$ $\mu_{y}$ åˆ†åˆ«ä¸ºæ¨¡å‹è¾“å‡ºå›¾åƒå’Œå‚è€ƒå›¾åƒçš„å‡å€¼ã€‚$\sigma_{x}$ $\sigma_{y}$ åˆ†åˆ«ä¸ºæ¨¡å‹è¾“å‡ºå›¾åƒå’Œå‚è€ƒå›¾åƒçš„æ ‡å‡†å·®ã€‚é€šå¸¸å– $c1="(K1*L)^2$ï¼Œ$C2=(K2*L)^2$ï¼Œ$C3=C2/2$ï¼Œä¸€èˆ¬åœ°$K1=0.01$ï¼Œ" $k2="0.03$," $l="255$ï¼ˆ" $l$æ˜¯åƒç´ å€¼çš„åŠ¨æ€èŒƒå›´ï¼Œä¸€èˆ¬éƒ½å–ä¸º255ï¼‰ã€‚ è¾“å‡ºå›¾ç‰‡å’Œç›®æ ‡å›¾ç‰‡çš„ç»“æ„ç›¸ä¼¼å€¼è¶Šå¤§ï¼Œåˆ™è¡¨ç¤ºç›¸ä¼¼æ€§è¶Šé«˜ï¼Œå›¾åƒå»æ¨¡ç³Šæ•ˆæœè¶Šå¥½ã€‚ ssimæ˜¯ä¸€ç§ç¬¦åˆäººç±»ç›´è§‰çš„å›¾åƒè´¨é‡è¯„ä»·æ ‡å‡†ã€‚ä»åå­—ä¸Šæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œè¿™ç§æŒ‡æ ‡æ˜¯åœ¨è‡´åŠ›äºå‘äººç±»çš„çœŸå®æ„ŸçŸ¥çœ‹é½ï¼Œè¯¦ç»†ç»†èŠ‚å¯ä»¥å‚è€ƒ[åŸè®ºæ–‡](https: www.cns.nyu.edu pub lcv wang03-preprint.pdf) mssim mssimç›¸å½“äºæ˜¯åœ¨å¤šä¸ªå°ºåº¦ä¸Šæ¥è¿›è¡ŒssimæŒ‡æ ‡çš„æµ‹è¯•ï¼Œç›¸å¯¹äºssimï¼Œå…¶èƒ½æ›´å¥½çš„è¡¡é‡å›¾åƒåˆ°è§‚çœ‹è€…çš„è·ç¦»ã€åƒç´ ä¿¡æ¯å¯†é›†ç¨‹åº¦ç­‰å› ç´ å¯¹è§‚çœ‹è€…ç»™å‡ºçš„ä¸»è§‚è¯„ä»·æ‰€äº§ç”Ÿçš„å½±å“ã€‚ è®ºæ–‡ä¸­ç»™å‡ºçš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œè§‚çœ‹è€…ç»™ä¸€ä¸ªåˆ†è¾¨ç‡ä¸º1080pçš„è¾ƒä¸ºæ¨¡ç³Šçš„ç”»é¢çš„è¯„åˆ†å¯èƒ½ä¼šæ¯”åˆ†è¾¨ç‡ä¸º720pçš„è¾ƒä¸ºé”åˆ©çš„ç”»é¢çš„è¯„åˆ†é«˜ã€‚å› æ­¤åœ¨è¯„ä»·å›¾åƒè´¨é‡çš„æ—¶å€™ä¸è€ƒè™‘å°ºåº¦å› ç´ å¯èƒ½ä¼šå¯¼è‡´å¾—å‡ºç‰‡é¢çš„ç»“æœã€‚ mssimæå‡ºåœ¨ä¸åŒåˆ†è¾¨ç‡ï¼ˆå°ºåº¦ï¼‰ä¸‹å¤šæ¬¡è®¡ç®—ç»“æ„ç›¸ä¼¼åº¦åç»¼åˆç»“æœå¾—åˆ°æœ€ç»ˆçš„è¯„ä»·æ•°å€¼ã€‚å…¶è®¡ç®—è¿‡ç¨‹æ¡†å›¾å¦‚ä¸‹æ‰€ç¤º ![image-20211120222301708](c:\users\administrator\appdata\roaming\typora\typora-user-images\image-20211120222301708.png) çš„è¯¦ç»†ç»†èŠ‚å¯ä»¥å‚è€ƒ[åŸè®ºæ–‡](https: ece.uwaterloo.ca ~z70wang publications msssim.pdf) ```python class psnr(nn.module): def forward(self,img1,img2): mse="((img1" - img2) ** 2).mean() è¾“å‡ºå›¾åƒå’Œå‚è€ƒå›¾åƒçš„ torch.log10(1.0 1.0 (mse (-10))) return çš„è®¡ç®—è¾ƒä¸ºå¤æ‚ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨ pytorch-msssim çš„æ¥å£æ¥è¿›è¡Œè®¡ç®— size_average="True," channel="3)" å®ä¾‹åŒ– æ¨¡å‹é¢„æµ‹ ç»˜å›¾å‡½æ•°å®šä¹‰ æ¨¡å‹åŠ è½½ 3) æ•°æ®åŠ è½½ 4) æ¨¡å‹é¢„æµ‹ä¸æŒ‡æ ‡åˆ†æ 5) ç»“æœå±•ç¤ºä¸ä¿å­˜ plot_tensor(tensor): tensor.dim()="=" 4: tensor="tensor.squeeze(0)" ret="transforms.ToPILImage()(tensor.squeeze(0))" plt.imshow(ret) è®­ç»ƒè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¿å­˜äº†å¤šä¸ª checkpoint ï¼Œç°åœ¨å¯¹å…¶è¿›è¡ŒåŠ è½½å’Œæµ‹è¯•ã€‚è¿™é‡Œæˆ‘ä»¬æä¾›äº†ä¸¤ç§é€‰æ‹© çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯é€‰æ‹©æŒ‡å®š checkpointï¼Œä¸€ç§æ˜¯é€‰æ‹©æœ€æ–°çš„ checkpointã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä»¥æœ€æ–°çš„ ä¸ºä¾‹è¿›è¡Œæµ‹è¯• option-a ï¼šæµ‹è¯•æŒ‡å®šepoch best_epoch="100" best_cp="f"{args.save_cp_dir}/Epoch_{best_epoch}.pt"" option-b ï¼šæµ‹è¯•æœ€ç»ˆepoch my_model.to("cuda").load_state_dict(torch.load(best_cp)) my_model="my_model.eval()" ç”±äºæ­¤æ¨¡å‹é‡‡ç”¨çš„æ˜¯å¤šå°ºåº¦è®­ç»ƒï¼Œå› æ­¤å¯¹äºå•å¼ è¾“å…¥å›¾åƒï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå®šä¹‰åŠ è½½å›¾åƒçš„å‡½æ•° load_images ä¸º load_images(blur_img_path,multi): sharp_img_path="blur_img_path.replace("blur","sharp")" os.path.exists(sharp_img_path): img_target="Image.open(sharp_img_path).convert('RGB')" img_input="Image.open(blur_img_path).convert('RGB')" è½¬æ¢ä¸ºimageç±»å‹ æ–¹ä¾¿è¿›è¡Œresize multi: h="input_b1.size()[1]" w="input_b1.size()[2]" int(w 2)])(input_b1)).unsqueeze(0) 4)])(input_b1)).unsqueeze(0) {'input_b1':input_b1, 'input_b2':input_b2, 'input_b3':input_b3, 'target_s1':target_s1} {'input_b1':unsqueeze(0), #ç›®å½•ä¸€ idx="1" blur_img_path="f"datasets/pictures/blur/test{idx}.png"" ç›®å½•äºŒ item="load_images(blur_img_path,args.multi)" output_l1,_,_="my_model((input_b1,input_b2,input_b3))" æŒ‡æ ‡åˆ†æ åŸå§‹æ¨¡ç³Šå›¾ç‰‡ä¸ä¸æ¨¡ç³Šå›¾ç‰‡ä¹‹é—´çš„æŒ‡æ ‡è®¡ç®— blur_psnr="psnr(input_b1,target_s1)" blur_ssim="ssim(input_b1,target_s1)" blur_mssim="mssim(input_b1,target_s1)" print(f"åŸå§‹æ¨¡ç³Šå›¾ç‰‡:psnr="{blur_psnr.float()}," åŸå§‹æ¨¡ç³Šå›¾ç‰‡:psnr="24.050003051757812," å»æ¨¡ç³Šå›¾ç‰‡ä¸ä¸æ¨¡ç³Šçš„å›¾ç‰‡ä¹‹é—´çš„æŒ‡æ ‡è®¡ç®— output_psnr="psnr(output_l1,target_s1)" output_ssim="ssim(output_l1,target_s1)" output_mssim="mssim(output_l1,target_s1)" print(f"ç½‘ç»œè¾“å‡ºå›¾ç‰‡:psnr="{output_psnr.float()}," ç½‘ç»œè¾“å‡ºå›¾ç‰‡:psnr="24.012224197387695," ç»“æœå±•ç¤º plt.figure(figsize="(6,10))" plt.subplot(311) plot_tensor(input_b1) plt.subplot(312) plot_tensor(output_l1) plt.subplot(313) plot_tensor(target_s1) ![image-20211120222412395](c:\users\administrator\appdata\roaming\typora\typora-user-images\image-20211120222412395.png) å°†ç»“æœä¿å­˜ save_name="blur_img_path.split("/")[-1]" save_path="os.path.join(args.save_dir,save_name)" save_img="transforms.ToPILImage()(output_l1.squeeze(0))" save_img.save(save_path) --- about me ğŸ‘‹ è¯»ä¹¦åŸå—ï¼ŒğŸ¤” åœ¨æœªæ¥é¢å‰ï¼Œæˆ‘ä»¬éƒ½æ˜¯å­©å­ï½ ğŸ“™ ä¸€ä¸ªçƒ­è¡·äºæ¢ç´¢å­¦ä¹ æ–°æ–¹å‘ã€æ–°äº‹ç‰©çš„æ™ºèƒ½äº§å“ç»ç†ï¼Œé—²æš‡æ—¶é—´å–œæ¬¢codingğŸ’»ã€ç”»å›¾ğŸ¨ã€éŸ³ä¹ğŸµã€å­¦ä¹ ing~ social media ğŸ› ï¸ blog: [http: oceaneyes.top](http: oceaneyes.top) âš¡ pmå¯¼èˆª: [https: pmhub.oceangzy.top](https: pmhub.oceangzy.top) â˜˜ï¸ cnblog: www.cnblogs.com oceaneyes-gzy ](https: ) ğŸŒ± ai prjè‡ªå·±éƒ¨ç½²çš„ä¸€äº›ç®—æ³•demo: ai.oceangzy.top ](http: ğŸ“« email: 1450136519@qq.com ğŸ’¬ wechat: [oceangzy](https: oceaneyes.top img wechatqrcode.jpg) å…¬ä¼—å·: [unclejoker-gzy](https: wechatgzh.jpeg) åŠ å…¥å°ç»„~ <img src="https://oceaneyes.top/img/zhishigroup.jpg" title="åŠ å…¥ç»„ç»‡" alt width="240"> 

##### ğŸ‘‹ æ„Ÿè°¢æ‰“èµ~
<img src="https://oceaneyes.top/img/alipay.jpg" title="æ”¯ä»˜å®æ‰“èµ" alt width="140">
<img src="https://oceaneyes.top/img/wechatpay.jpg" title="å¾®ä¿¡æ‰“èµ" alt width="140"> 
</{remaining},{rate_fmt}]'></tensorboardX.writer.SummaryWriter></torch.optim.lr_scheduler.StepLR></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://oceaneyes.top">OCEAN.GZY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://oceaneyes.top/2021/11/19/pytorch%E5%9B%BE%E5%83%8F%E5%8E%BB%E6%A8%A1%E7%B3%8A/">http://oceaneyes.top/2021/11/19/pytorch%E5%9B%BE%E5%83%8F%E5%8E%BB%E6%A8%A1%E7%B3%8A/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://oceaneyes.top" target="_blank">OCAEN.GZYè¯»ä¹¦åŸå—</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Machine-Learning/">Machine Learning</a><a class="post-meta__tags" href="/tags/Algorithm/">Algorithm</a><a class="post-meta__tags" href="/tags/PyTorch/">PyTorch</a><a class="post-meta__tags" href="/tags/CV/">CV</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/01/15/item2vec%E5%AE%9E%E7%8E%B0%E7%94%B5%E5%BD%B1%E6%8E%A8%E8%8D%90/" title="è®­ç»ƒitem2vecå®ç°ç”µå½±æ¨è"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">è®­ç»ƒitem2vecå®ç°ç”µå½±æ¨è</div></div></a></div><div class="next-post pull-right"><a href="/2021/08/01/bert-tf2-6/" title="Bert-TF-2.6ä¿®æ”¹-è‡ªè°ƒé€‚é…ç‰ˆ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Bert-TF-2.6ä¿®æ”¹-è‡ªè°ƒé€‚é…ç‰ˆ</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2018/10/01/Algorithm%E5%85%A5%E9%97%A8%E8%A7%A3%E8%AF%BB/" title="Algorithmå…¥é—¨è§£è¯»"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-10-01</div><div class="title">Algorithmå…¥é—¨è§£è¯»</div></div></a></div><div><a href="/2021/01/03/NLP-Bert%E8%AF%AD%E4%B9%89%E6%83%85%E6%84%9F%E5%88%86%E7%B1%BB/" title="NLP-Bertè¯­ä¹‰æƒ…æ„Ÿåˆ†ç±»"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-03</div><div class="title">NLP-Bertè¯­ä¹‰æƒ…æ„Ÿåˆ†ç±»</div></div></a></div><div><a href="/2021/03/28/ctr-predict/" title="å¹¿å‘ŠæŠ•æ”¾ä¸­çš„CTRé¢„ä¼°æ¨¡å‹"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-28</div><div class="title">å¹¿å‘ŠæŠ•æ”¾ä¸­çš„CTRé¢„ä¼°æ¨¡å‹</div></div></a></div><div><a href="/2022/01/15/item2vec%E5%AE%9E%E7%8E%B0%E7%94%B5%E5%BD%B1%E6%8E%A8%E8%8D%90/" title="è®­ç»ƒitem2vecå®ç°ç”µå½±æ¨è"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-15</div><div class="title">è®­ç»ƒitem2vecå®ç°ç”µå½±æ¨è</div></div></a></div><div><a href="/2021/03/01/lstm/" title="LSTM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-01</div><div class="title">LSTM</div></div></a></div><div><a href="/2021/01/01/%E4%BD%BF%E7%94%A8%E5%86%B3%E7%AD%96%E6%A0%91%E9%A2%84%E6%B5%8B%E9%9A%90%E6%80%A7%E7%9C%BC%E9%95%9C%E7%B1%BB%E5%9E%8B/" title="æ¡ˆä¾‹-ä½¿ç”¨å†³ç­–æ ‘é¢„æµ‹éšæ€§çœ¼é•œç±»å‹"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-01</div><div class="title">æ¡ˆä¾‹-ä½¿ç”¨å†³ç­–æ ‘é¢„æµ‹éšæ€§çœ¼é•œç±»å‹</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">OCEAN.GZY</div><div class="author-info__description">This is MyBlog Notes.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">166</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">114</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">91</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/04/AI%E4%BA%A7%E5%93%81%E8%A7%86%E8%A7%92%E4%B8%8B%E7%9A%84ChatGPT/" title="AIäº§å“è§†è§’ä¸‹çš„ChatGPT">AIäº§å“è§†è§’ä¸‹çš„ChatGPT</a><time datetime="2023-03-04T14:58:39.000Z" title="å‘è¡¨äº 2023-03-04 22:58:39">2023-03-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/06/01/python%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%85%AD%E5%A4%A7%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" title="Pythonè®¾è®¡æ¨¡å¼-å…­å¤§è®¾è®¡åŸåˆ™">Pythonè®¾è®¡æ¨¡å¼-å…­å¤§è®¾è®¡åŸåˆ™</a><time datetime="2022-06-01T15:50:00.000Z" title="å‘è¡¨äº 2022-06-01 23:50:00">2022-06-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/06/01/python%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E7%BB%93%E6%9E%84%E5%9E%8B/" title="Pythonè®¾è®¡æ¨¡å¼-ç»“æ„å‹">Pythonè®¾è®¡æ¨¡å¼-ç»“æ„å‹</a><time datetime="2022-06-01T15:33:00.000Z" title="å‘è¡¨äº 2022-06-01 23:33:00">2022-06-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/06/01/python%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A1%8C%E4%B8%BA%E5%9E%8B/" title="Pythonè®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹">Pythonè®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹</a><time datetime="2022-06-01T15:31:00.000Z" title="å‘è¡¨äº 2022-06-01 23:31:00">2022-06-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/06/01/python%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%88%9B%E5%BB%BA%E5%9E%8B/" title="Pythonè®¾è®¡æ¨¡å¼-åˆ›å»ºå‹">Pythonè®¾è®¡æ¨¡å¼-åˆ›å»ºå‹</a><time datetime="2022-06-01T15:30:00.000Z" title="å‘è¡¨äº 2022-06-01 23:30:00">2022-06-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By OCEAN.GZY</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>