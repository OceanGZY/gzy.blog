{"title":"SpringBoot-WebSocket聊天室","slug":"SpringBoot-WebSocket 聊天室","date":"2018-03-02T14:23:00.000Z","updated":"2022-09-30T06:56:37.164Z","comments":true,"path":"api/articles/SpringBoot-WebSocket 聊天室.json","excerpt":null,"covers":["https://oceaneyes.top/img/zhishigroup.jpg","https://oceaneyes.top/img/alipay.jpg","https://oceaneyes.top/img/wechatpay.jpg"],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h1 id=\"springboot-websocket-聊天室\">SpringBoot-WebSocket 聊天室</h1>\n<h2 id=\"配置类config\">配置类Config</h2>\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb1-1\"><a href=\"#cb1-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\">// websocket配置</span></span>\n<span id=\"cb1-2\"><a href=\"#cb1-2\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"at\">@Bean</span></span>\n<span id=\"cb1-3\"><a href=\"#cb1-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> ServerEndpointExporter <span class=\"fu\">serverEndpointExporter</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb1-4\"><a href=\"#cb1-4\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"cf\">return</span> <span class=\"kw\">new</span> <span class=\"fu\">ServerEndpointExporter</span><span class=\"op\">();</span></span>\n<span id=\"cb1-5\"><a href=\"#cb1-5\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span></code></pre></div>\n<h2 id=\"业务类controller\">业务类Controller</h2>\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb2-1\"><a href=\"#cb2-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">org</span><span class=\"op\">.</span><span class=\"im\">springframework</span><span class=\"op\">.</span><span class=\"im\">stereotype</span><span class=\"op\">.</span><span class=\"im\">Component</span><span class=\"op\">;</span></span>\n<span id=\"cb2-2\"><a href=\"#cb2-2\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb2-3\"><a href=\"#cb2-3\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">javax</span><span class=\"op\">.</span><span class=\"im\">websocket</span><span class=\"op\">.*;</span></span>\n<span id=\"cb2-4\"><a href=\"#cb2-4\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">javax</span><span class=\"op\">.</span><span class=\"im\">websocket</span><span class=\"op\">.</span><span class=\"im\">server</span><span class=\"op\">.</span><span class=\"im\">PathParam</span><span class=\"op\">;</span></span>\n<span id=\"cb2-5\"><a href=\"#cb2-5\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">javax</span><span class=\"op\">.</span><span class=\"im\">websocket</span><span class=\"op\">.</span><span class=\"im\">server</span><span class=\"op\">.</span><span class=\"im\">ServerEndpoint</span><span class=\"op\">;</span></span>\n<span id=\"cb2-6\"><a href=\"#cb2-6\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">java</span><span class=\"op\">.</span><span class=\"im\">util</span><span class=\"op\">.</span><span class=\"im\">HashMap</span><span class=\"op\">;</span></span>\n<span id=\"cb2-7\"><a href=\"#cb2-7\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">java</span><span class=\"op\">.</span><span class=\"im\">util</span><span class=\"op\">.</span><span class=\"im\">Map</span><span class=\"op\">;</span></span>\n<span id=\"cb2-8\"><a href=\"#cb2-8\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">java</span><span class=\"op\">.</span><span class=\"im\">util</span><span class=\"op\">.</span><span class=\"im\">concurrent</span><span class=\"op\">.</span><span class=\"im\">CopyOnWriteArraySet</span><span class=\"op\">;</span></span>\n<span id=\"cb2-9\"><a href=\"#cb2-9\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb2-10\"><a href=\"#cb2-10\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\">/**</span></span>\n<span id=\"cb2-11\"><a href=\"#cb2-11\" aria-hidden=\"true\" tabindex=\"-1\"></a> <span class=\"co\">*</span>  <span class=\"co\">*</span> <span class=\"co\">@</span>Description<span class=\"co\">:</span> websocket<span class=\"co\">的具体实现类</span></span>\n<span id=\"cb2-12\"><a href=\"#cb2-12\" aria-hidden=\"true\" tabindex=\"-1\"></a> <span class=\"co\">*</span>  <span class=\"co\">*</span> <span class=\"co\">使用</span>springboot<span class=\"co\">的唯一区别是要@</span>Component<span class=\"co\">声明下，而使用独立容器是由容器自己管理</span>websocket<span class=\"co\">的，</span></span>\n<span id=\"cb2-13\"><a href=\"#cb2-13\" aria-hidden=\"true\" tabindex=\"-1\"></a> <span class=\"co\">*</span>  <span class=\"co\">*</span> <span class=\"co\">但在</span>springboot<span class=\"co\">中连容器都是</span>spring<span class=\"co\">管理的。</span></span>\n<span id=\"cb2-14\"><a href=\"#cb2-14\" aria-hidden=\"true\" tabindex=\"-1\"></a> <span class=\"co\">*</span>     <span class=\"co\">虽然@</span>Component<span class=\"co\">默认是单例模式的，但</span>springboot<span class=\"co\">还是会为每个</span>websocket<span class=\"co\">连接初始化一个</span>bean<span class=\"co\">，</span></span>\n<span id=\"cb2-15\"><a href=\"#cb2-15\" aria-hidden=\"true\" tabindex=\"-1\"></a> <span class=\"co\">*</span>     <span class=\"co\">所以可以用一个静态</span>set<span class=\"co\">保存起来。</span></span>\n<span id=\"cb2-16\"><a href=\"#cb2-16\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\">*/</span></span>\n<span id=\"cb2-17\"><a href=\"#cb2-17\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"at\">@ServerEndpoint</span><span class=\"op\">(</span>value <span class=\"op\">=</span> <span class=\"st\">&quot;/websocket/&#123;nickName&#125;&quot;</span><span class=\"op\">)</span></span>\n<span id=\"cb2-18\"><a href=\"#cb2-18\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"at\">@Component</span></span>\n<span id=\"cb2-19\"><a href=\"#cb2-19\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">public</span> <span class=\"kw\">class</span> MyWebSocket <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-20\"><a href=\"#cb2-20\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">//用来存放每个客户端对应的MyWebSocket对象。</span></span>\n<span id=\"cb2-21\"><a href=\"#cb2-21\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> <span class=\"dt\">static</span> <span class=\"bu\">CopyOnWriteArraySet</span><span class=\"op\">&lt;</span>MyWebSocket<span class=\"op\">&gt;</span> webSocketSet <span class=\"op\">=</span> <span class=\"kw\">new</span> <span class=\"bu\">CopyOnWriteArraySet</span><span class=\"op\">&lt;</span>MyWebSocket<span class=\"op\">&gt;();</span></span>\n<span id=\"cb2-22\"><a href=\"#cb2-22\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> <span class=\"dt\">static</span> <span class=\"bu\">Map</span><span class=\"op\">&lt;</span>Session<span class=\"op\">,</span> UserInfo<span class=\"op\">&gt;</span> connectmap <span class=\"op\">=</span> <span class=\"kw\">new</span> <span class=\"bu\">HashMap</span><span class=\"op\">&lt;&gt;();</span><span class=\"co\">//用session作为key，保存用户信息</span></span>\n<span id=\"cb2-23\"><a href=\"#cb2-23\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">//与某个客户端的连接会话，需要通过它来给客户端发送数据</span></span>\n<span id=\"cb2-24\"><a href=\"#cb2-24\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> Session session<span class=\"op\">;</span></span>\n<span id=\"cb2-25\"><a href=\"#cb2-25\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">/**</span></span>\n<span id=\"cb2-26\"><a href=\"#cb2-26\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">连接建立成功调用的方法</span></span>\n<span id=\"cb2-27\"><a href=\"#cb2-27\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*/</span></span>\n<span id=\"cb2-28\"><a href=\"#cb2-28\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"at\">@OnOpen</span></span>\n<span id=\"cb2-29\"><a href=\"#cb2-29\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">onOpen</span><span class=\"op\">(</span>Session session<span class=\"op\">,</span> <span class=\"at\">@PathParam</span><span class=\"op\">(</span><span class=\"st\">&quot;nickName&quot;</span><span class=\"op\">)</span> <span class=\"bu\">String</span> nickName<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-30\"><a href=\"#cb2-30\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">session</span> <span class=\"op\">=</span> session<span class=\"op\">;</span></span>\n<span id=\"cb2-31\"><a href=\"#cb2-31\" aria-hidden=\"true\" tabindex=\"-1\"></a>        UserInfo userInfo <span class=\"op\">=</span> <span class=\"kw\">new</span> <span class=\"fu\">UserInfo</span><span class=\"op\">(</span>session<span class=\"op\">.</span><span class=\"fu\">getId</span><span class=\"op\">(),</span>nickName<span class=\"op\">);</span></span>\n<span id=\"cb2-32\"><a href=\"#cb2-32\" aria-hidden=\"true\" tabindex=\"-1\"></a>        connectmap<span class=\"op\">.</span><span class=\"fu\">put</span><span class=\"op\">(</span>session<span class=\"op\">,</span>userInfo<span class=\"op\">);</span></span>\n<span id=\"cb2-33\"><a href=\"#cb2-33\" aria-hidden=\"true\" tabindex=\"-1\"></a>        webSocketSet<span class=\"op\">.</span><span class=\"fu\">add</span><span class=\"op\">(</span><span class=\"kw\">this</span><span class=\"op\">);</span>     <span class=\"co\">//加入set中</span></span>\n<span id=\"cb2-34\"><a href=\"#cb2-34\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">System</span><span class=\"op\">.</span><span class=\"fu\">out</span><span class=\"op\">.</span><span class=\"fu\">println</span><span class=\"op\">(</span>nickName<span class=\"op\">+</span><span class=\"st\">&quot; 上线了！当前在线人数为&quot;</span> <span class=\"op\">+</span> webSocketSet<span class=\"op\">.</span><span class=\"fu\">size</span><span class=\"op\">());</span></span>\n<span id=\"cb2-35\"><a href=\"#cb2-35\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"co\">//群发消息，告诉每一位</span></span>\n<span id=\"cb2-36\"><a href=\"#cb2-36\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"fu\">broadcast</span><span class=\"op\">(</span>nickName<span class=\"op\">+</span><span class=\"st\">&quot; 上线了！--&gt;当前在线人数为：&quot;</span><span class=\"op\">+</span>webSocketSet<span class=\"op\">.</span><span class=\"fu\">size</span><span class=\"op\">());</span></span>\n<span id=\"cb2-37\"><a href=\"#cb2-37\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-38\"><a href=\"#cb2-38\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">/**</span></span>\n<span id=\"cb2-39\"><a href=\"#cb2-39\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">连接关闭调用的方法</span></span>\n<span id=\"cb2-40\"><a href=\"#cb2-40\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*/</span></span>\n<span id=\"cb2-41\"><a href=\"#cb2-41\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"at\">@OnClose</span></span>\n<span id=\"cb2-42\"><a href=\"#cb2-42\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">onClose</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-43\"><a href=\"#cb2-43\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">String</span> nickName<span class=\"op\">=</span>connectmap<span class=\"op\">.</span><span class=\"fu\">get</span><span class=\"op\">(</span>session<span class=\"op\">).</span><span class=\"fu\">getNickName</span><span class=\"op\">();</span></span>\n<span id=\"cb2-44\"><a href=\"#cb2-44\" aria-hidden=\"true\" tabindex=\"-1\"></a>        connectmap<span class=\"op\">.</span><span class=\"fu\">remove</span><span class=\"op\">(</span>session<span class=\"op\">);</span></span>\n<span id=\"cb2-45\"><a href=\"#cb2-45\" aria-hidden=\"true\" tabindex=\"-1\"></a>        webSocketSet<span class=\"op\">.</span><span class=\"fu\">remove</span><span class=\"op\">(</span><span class=\"kw\">this</span><span class=\"op\">);</span>  <span class=\"co\">//从set中删除</span></span>\n<span id=\"cb2-46\"><a href=\"#cb2-46\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">System</span><span class=\"op\">.</span><span class=\"fu\">out</span><span class=\"op\">.</span><span class=\"fu\">println</span><span class=\"op\">(</span>nickName<span class=\"op\">+</span><span class=\"st\">&quot; 下线了！当前在线人数为&quot;</span> <span class=\"op\">+</span> webSocketSet<span class=\"op\">.</span><span class=\"fu\">size</span><span class=\"op\">());</span></span>\n<span id=\"cb2-47\"><a href=\"#cb2-47\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"co\">//群发消息，告诉每一位</span></span>\n<span id=\"cb2-48\"><a href=\"#cb2-48\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"fu\">broadcast</span><span class=\"op\">(</span>nickName<span class=\"op\">+</span><span class=\"st\">&quot; 下线，当前在线人数为：&quot;</span><span class=\"op\">+</span>webSocketSet<span class=\"op\">.</span><span class=\"fu\">size</span><span class=\"op\">());</span></span>\n<span id=\"cb2-49\"><a href=\"#cb2-49\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-50\"><a href=\"#cb2-50\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">/**</span></span>\n<span id=\"cb2-51\"><a href=\"#cb2-51\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">收到客户端消息后调用的方法</span></span>\n<span id=\"cb2-52\"><a href=\"#cb2-52\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span></span>\n<span id=\"cb2-53\"><a href=\"#cb2-53\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\">     * @</span>param message <span class=\"co\">客户端发送过来的消息</span></span>\n<span id=\"cb2-54\"><a href=\"#cb2-54\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">*/</span></span>\n<span id=\"cb2-55\"><a href=\"#cb2-55\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"at\">@OnMessage</span></span>\n<span id=\"cb2-56\"><a href=\"#cb2-56\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">onMessage</span><span class=\"op\">(</span><span class=\"bu\">String</span> message<span class=\"op\">,</span> Session session<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-57\"><a href=\"#cb2-57\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">System</span><span class=\"op\">.</span><span class=\"fu\">out</span><span class=\"op\">.</span><span class=\"fu\">println</span><span class=\"op\">(</span><span class=\"st\">&quot;来自客户端的消息:&quot;</span> <span class=\"op\">+</span> message<span class=\"op\">);</span></span>\n<span id=\"cb2-58\"><a href=\"#cb2-58\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"co\">//群发消息</span></span>\n<span id=\"cb2-59\"><a href=\"#cb2-59\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">String</span> nickName<span class=\"op\">=</span>connectmap<span class=\"op\">.</span><span class=\"fu\">get</span><span class=\"op\">(</span>session<span class=\"op\">).</span><span class=\"fu\">getNickName</span><span class=\"op\">();</span></span>\n<span id=\"cb2-60\"><a href=\"#cb2-60\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"fu\">broadcast</span><span class=\"op\">(</span>nickName<span class=\"op\">+</span><span class=\"st\">&quot; 说：&quot;</span><span class=\"op\">+</span>message<span class=\"op\">);</span></span>\n<span id=\"cb2-61\"><a href=\"#cb2-61\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-62\"><a href=\"#cb2-62\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">/**</span></span>\n<span id=\"cb2-63\"><a href=\"#cb2-63\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">发生错误时调用</span></span>\n<span id=\"cb2-64\"><a href=\"#cb2-64\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span></span>\n<span id=\"cb2-65\"><a href=\"#cb2-65\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*/</span></span>\n<span id=\"cb2-66\"><a href=\"#cb2-66\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"at\">@OnError</span></span>\n<span id=\"cb2-67\"><a href=\"#cb2-67\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">onError</span><span class=\"op\">(</span>Session session<span class=\"op\">,</span> <span class=\"bu\">Throwable</span> error<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-68\"><a href=\"#cb2-68\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">System</span><span class=\"op\">.</span><span class=\"fu\">out</span><span class=\"op\">.</span><span class=\"fu\">println</span><span class=\"op\">(</span><span class=\"st\">&quot;发生错误&quot;</span><span class=\"op\">);</span></span>\n<span id=\"cb2-69\"><a href=\"#cb2-69\" aria-hidden=\"true\" tabindex=\"-1\"></a>        error<span class=\"op\">.</span><span class=\"fu\">printStackTrace</span><span class=\"op\">();</span></span>\n<span id=\"cb2-70\"><a href=\"#cb2-70\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-71\"><a href=\"#cb2-71\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">/**</span></span>\n<span id=\"cb2-72\"><a href=\"#cb2-72\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">群发自定义消息</span></span>\n<span id=\"cb2-73\"><a href=\"#cb2-73\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">*/</span></span>\n<span id=\"cb2-74\"><a href=\"#cb2-74\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span>  <span class=\"dt\">void</span> <span class=\"fu\">broadcast</span><span class=\"op\">(</span><span class=\"bu\">String</span> message<span class=\"op\">)&#123;</span></span>\n<span id=\"cb2-75\"><a href=\"#cb2-75\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"cf\">for</span> <span class=\"op\">(</span>MyWebSocket item <span class=\"op\">:</span> webSocketSet<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-76\"><a href=\"#cb2-76\" aria-hidden=\"true\" tabindex=\"-1\"></a>            <span class=\"co\">//同步异步说明参考：http://blog.csdn.net/who_is_xiaoming/article/details/53287691</span></span>\n<span id=\"cb2-77\"><a href=\"#cb2-77\" aria-hidden=\"true\" tabindex=\"-1\"></a>            <span class=\"co\">//this.session.getBasicRemote().sendText(message);</span></span>\n<span id=\"cb2-78\"><a href=\"#cb2-78\" aria-hidden=\"true\" tabindex=\"-1\"></a>            item<span class=\"op\">.</span><span class=\"fu\">session</span><span class=\"op\">.</span><span class=\"fu\">getAsyncRemote</span><span class=\"op\">().</span><span class=\"fu\">sendText</span><span class=\"op\">(</span>message<span class=\"op\">);</span><span class=\"co\">//异步发送消息.</span></span>\n<span id=\"cb2-79\"><a href=\"#cb2-79\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-80\"><a href=\"#cb2-80\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-81\"><a href=\"#cb2-81\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"op\">&#125;</span></span></code></pre></div>\n<h2 id=\"实体类entity\">实体类Entity</h2>\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb3-1\"><a href=\"#cb3-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">public</span> <span class=\"kw\">class</span> UserInfo <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-2\"><a href=\"#cb3-2\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> <span class=\"bu\">String</span> id<span class=\"op\">;</span></span>\n<span id=\"cb3-3\"><a href=\"#cb3-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> <span class=\"bu\">String</span> nickName<span class=\"op\">;</span></span>\n<span id=\"cb3-4\"><a href=\"#cb3-4\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> <span class=\"bu\">String</span> password<span class=\"op\">;</span></span>\n<span id=\"cb3-5\"><a href=\"#cb3-5\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-6\"><a href=\"#cb3-6\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"fu\">UserInfo</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-7\"><a href=\"#cb3-7\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-8\"><a href=\"#cb3-8\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-9\"><a href=\"#cb3-9\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"fu\">UserInfo</span><span class=\"op\">(</span><span class=\"bu\">String</span> id<span class=\"op\">,</span> <span class=\"bu\">String</span> nickName<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-10\"><a href=\"#cb3-10\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">id</span> <span class=\"op\">=</span> id<span class=\"op\">;</span></span>\n<span id=\"cb3-11\"><a href=\"#cb3-11\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">nickName</span> <span class=\"op\">=</span> nickName<span class=\"op\">;</span></span>\n<span id=\"cb3-12\"><a href=\"#cb3-12\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-13\"><a href=\"#cb3-13\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-14\"><a href=\"#cb3-14\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"bu\">String</span> <span class=\"fu\">getId</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-15\"><a href=\"#cb3-15\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"cf\">return</span> id<span class=\"op\">;</span></span>\n<span id=\"cb3-16\"><a href=\"#cb3-16\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-17\"><a href=\"#cb3-17\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-18\"><a href=\"#cb3-18\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">setId</span><span class=\"op\">(</span><span class=\"bu\">String</span> id<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-19\"><a href=\"#cb3-19\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">id</span> <span class=\"op\">=</span> id<span class=\"op\">;</span></span>\n<span id=\"cb3-20\"><a href=\"#cb3-20\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-21\"><a href=\"#cb3-21\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-22\"><a href=\"#cb3-22\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"bu\">String</span> <span class=\"fu\">getNickName</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-23\"><a href=\"#cb3-23\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"cf\">return</span> nickName<span class=\"op\">;</span></span>\n<span id=\"cb3-24\"><a href=\"#cb3-24\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-25\"><a href=\"#cb3-25\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-26\"><a href=\"#cb3-26\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">setNickName</span><span class=\"op\">(</span><span class=\"bu\">String</span> nickName<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-27\"><a href=\"#cb3-27\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">nickName</span> <span class=\"op\">=</span> nickName<span class=\"op\">;</span></span>\n<span id=\"cb3-28\"><a href=\"#cb3-28\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-29\"><a href=\"#cb3-29\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-30\"><a href=\"#cb3-30\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"bu\">String</span> <span class=\"fu\">getPassword</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-31\"><a href=\"#cb3-31\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"cf\">return</span> password<span class=\"op\">;</span></span>\n<span id=\"cb3-32\"><a href=\"#cb3-32\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-33\"><a href=\"#cb3-33\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-34\"><a href=\"#cb3-34\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">setPassword</span><span class=\"op\">(</span><span class=\"bu\">String</span> password<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-35\"><a href=\"#cb3-35\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">password</span> <span class=\"op\">=</span> password<span class=\"op\">;</span></span>\n<span id=\"cb3-36\"><a href=\"#cb3-36\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-37\"><a href=\"#cb3-37\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"op\">&#125;</span></span></code></pre></div>\n<hr>\n<h3 id=\"about-me\">About ME</h3>\n<h5 id=\"读书城南-在未来面前我们都是孩子\">👋 读书城南，🤔\n在未来面前，我们都是孩子～</h5>\n<ul>\n<li>📙\n一个热衷于探索学习新方向、新事物的智能产品经理，闲暇时间喜欢coding💻、画图🎨、音乐🎵、学习ing~</li>\n</ul>\n<h5 id=\"social-media\">👋 Social Media</h5>\n<ul>\n<li><p>🛠️ Blog: <a href=\"http://oceaneyes.top\">http://oceaneyes.top</a></p></li>\n<li><p>⚡ PM导航: <a href=\"https://pmhub.oceangzy.top\">https://pmhub.oceangzy.top</a></p></li>\n<li><p>☘️ CNBLOG: <a href=\"https://www.cnblogs.com/oceaneyes-gzy/\">https://www.cnblogs.com/oceaneyes-gzy/</a></p></li>\n<li><p>🌱 AI PRJ自己部署的一些算法demo: <a href=\"http://ai.oceangzy.top/\">http://ai.oceangzy.top/</a></p></li>\n<li><p>📫 Email: 1450136519@qq.com</p></li>\n<li><p>💬 WeChat: <a href=\"https://oceaneyes.top/img/wechatqrcode.jpg\">OCEANGZY</a></p></li>\n<li><p>💬 公众号: <a href=\"https://oceaneyes.top/img/wechatgzh.jpeg\">UncleJoker-GZY</a></p></li>\n</ul>\n<h5 id=\"加入小组\">👋 加入小组~</h5>\n<p><img src=\"https://oceaneyes.top/img/zhishigroup.jpg\" title=\"加入组织\" alt width=\"240\"></p>\n<h5 id=\"感谢打赏\">👋 感谢打赏~</h5>\n<p><img src=\"https://oceaneyes.top/img/alipay.jpg\" title=\"支付宝打赏\" alt width=\"140\">\n<img src=\"https://oceaneyes.top/img/wechatpay.jpg\" title=\"微信打赏\" alt width=\"140\"></p>\n","more":"<h1 id=\"springboot-websocket-聊天室\">SpringBoot-WebSocket 聊天室</h1>\n<h2 id=\"配置类config\">配置类Config</h2>\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb1-1\"><a href=\"#cb1-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\">// websocket配置</span></span>\n<span id=\"cb1-2\"><a href=\"#cb1-2\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"at\">@Bean</span></span>\n<span id=\"cb1-3\"><a href=\"#cb1-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> ServerEndpointExporter <span class=\"fu\">serverEndpointExporter</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb1-4\"><a href=\"#cb1-4\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"cf\">return</span> <span class=\"kw\">new</span> <span class=\"fu\">ServerEndpointExporter</span><span class=\"op\">();</span></span>\n<span id=\"cb1-5\"><a href=\"#cb1-5\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span></code></pre></div>\n<h2 id=\"业务类controller\">业务类Controller</h2>\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb2-1\"><a href=\"#cb2-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">org</span><span class=\"op\">.</span><span class=\"im\">springframework</span><span class=\"op\">.</span><span class=\"im\">stereotype</span><span class=\"op\">.</span><span class=\"im\">Component</span><span class=\"op\">;</span></span>\n<span id=\"cb2-2\"><a href=\"#cb2-2\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb2-3\"><a href=\"#cb2-3\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">javax</span><span class=\"op\">.</span><span class=\"im\">websocket</span><span class=\"op\">.*;</span></span>\n<span id=\"cb2-4\"><a href=\"#cb2-4\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">javax</span><span class=\"op\">.</span><span class=\"im\">websocket</span><span class=\"op\">.</span><span class=\"im\">server</span><span class=\"op\">.</span><span class=\"im\">PathParam</span><span class=\"op\">;</span></span>\n<span id=\"cb2-5\"><a href=\"#cb2-5\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">javax</span><span class=\"op\">.</span><span class=\"im\">websocket</span><span class=\"op\">.</span><span class=\"im\">server</span><span class=\"op\">.</span><span class=\"im\">ServerEndpoint</span><span class=\"op\">;</span></span>\n<span id=\"cb2-6\"><a href=\"#cb2-6\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">java</span><span class=\"op\">.</span><span class=\"im\">util</span><span class=\"op\">.</span><span class=\"im\">HashMap</span><span class=\"op\">;</span></span>\n<span id=\"cb2-7\"><a href=\"#cb2-7\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">java</span><span class=\"op\">.</span><span class=\"im\">util</span><span class=\"op\">.</span><span class=\"im\">Map</span><span class=\"op\">;</span></span>\n<span id=\"cb2-8\"><a href=\"#cb2-8\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">import</span> <span class=\"im\">java</span><span class=\"op\">.</span><span class=\"im\">util</span><span class=\"op\">.</span><span class=\"im\">concurrent</span><span class=\"op\">.</span><span class=\"im\">CopyOnWriteArraySet</span><span class=\"op\">;</span></span>\n<span id=\"cb2-9\"><a href=\"#cb2-9\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb2-10\"><a href=\"#cb2-10\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\">/**</span></span>\n<span id=\"cb2-11\"><a href=\"#cb2-11\" aria-hidden=\"true\" tabindex=\"-1\"></a> <span class=\"co\">*</span>  <span class=\"co\">*</span> <span class=\"co\">@</span>Description<span class=\"co\">:</span> websocket<span class=\"co\">的具体实现类</span></span>\n<span id=\"cb2-12\"><a href=\"#cb2-12\" aria-hidden=\"true\" tabindex=\"-1\"></a> <span class=\"co\">*</span>  <span class=\"co\">*</span> <span class=\"co\">使用</span>springboot<span class=\"co\">的唯一区别是要@</span>Component<span class=\"co\">声明下，而使用独立容器是由容器自己管理</span>websocket<span class=\"co\">的，</span></span>\n<span id=\"cb2-13\"><a href=\"#cb2-13\" aria-hidden=\"true\" tabindex=\"-1\"></a> <span class=\"co\">*</span>  <span class=\"co\">*</span> <span class=\"co\">但在</span>springboot<span class=\"co\">中连容器都是</span>spring<span class=\"co\">管理的。</span></span>\n<span id=\"cb2-14\"><a href=\"#cb2-14\" aria-hidden=\"true\" tabindex=\"-1\"></a> <span class=\"co\">*</span>     <span class=\"co\">虽然@</span>Component<span class=\"co\">默认是单例模式的，但</span>springboot<span class=\"co\">还是会为每个</span>websocket<span class=\"co\">连接初始化一个</span>bean<span class=\"co\">，</span></span>\n<span id=\"cb2-15\"><a href=\"#cb2-15\" aria-hidden=\"true\" tabindex=\"-1\"></a> <span class=\"co\">*</span>     <span class=\"co\">所以可以用一个静态</span>set<span class=\"co\">保存起来。</span></span>\n<span id=\"cb2-16\"><a href=\"#cb2-16\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\">*/</span></span>\n<span id=\"cb2-17\"><a href=\"#cb2-17\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"at\">@ServerEndpoint</span><span class=\"op\">(</span>value <span class=\"op\">=</span> <span class=\"st\">&quot;/websocket/&#123;nickName&#125;&quot;</span><span class=\"op\">)</span></span>\n<span id=\"cb2-18\"><a href=\"#cb2-18\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"at\">@Component</span></span>\n<span id=\"cb2-19\"><a href=\"#cb2-19\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">public</span> <span class=\"kw\">class</span> MyWebSocket <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-20\"><a href=\"#cb2-20\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">//用来存放每个客户端对应的MyWebSocket对象。</span></span>\n<span id=\"cb2-21\"><a href=\"#cb2-21\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> <span class=\"dt\">static</span> <span class=\"bu\">CopyOnWriteArraySet</span><span class=\"op\">&lt;</span>MyWebSocket<span class=\"op\">&gt;</span> webSocketSet <span class=\"op\">=</span> <span class=\"kw\">new</span> <span class=\"bu\">CopyOnWriteArraySet</span><span class=\"op\">&lt;</span>MyWebSocket<span class=\"op\">&gt;();</span></span>\n<span id=\"cb2-22\"><a href=\"#cb2-22\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> <span class=\"dt\">static</span> <span class=\"bu\">Map</span><span class=\"op\">&lt;</span>Session<span class=\"op\">,</span> UserInfo<span class=\"op\">&gt;</span> connectmap <span class=\"op\">=</span> <span class=\"kw\">new</span> <span class=\"bu\">HashMap</span><span class=\"op\">&lt;&gt;();</span><span class=\"co\">//用session作为key，保存用户信息</span></span>\n<span id=\"cb2-23\"><a href=\"#cb2-23\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">//与某个客户端的连接会话，需要通过它来给客户端发送数据</span></span>\n<span id=\"cb2-24\"><a href=\"#cb2-24\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> Session session<span class=\"op\">;</span></span>\n<span id=\"cb2-25\"><a href=\"#cb2-25\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">/**</span></span>\n<span id=\"cb2-26\"><a href=\"#cb2-26\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">连接建立成功调用的方法</span></span>\n<span id=\"cb2-27\"><a href=\"#cb2-27\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*/</span></span>\n<span id=\"cb2-28\"><a href=\"#cb2-28\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"at\">@OnOpen</span></span>\n<span id=\"cb2-29\"><a href=\"#cb2-29\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">onOpen</span><span class=\"op\">(</span>Session session<span class=\"op\">,</span> <span class=\"at\">@PathParam</span><span class=\"op\">(</span><span class=\"st\">&quot;nickName&quot;</span><span class=\"op\">)</span> <span class=\"bu\">String</span> nickName<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-30\"><a href=\"#cb2-30\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">session</span> <span class=\"op\">=</span> session<span class=\"op\">;</span></span>\n<span id=\"cb2-31\"><a href=\"#cb2-31\" aria-hidden=\"true\" tabindex=\"-1\"></a>        UserInfo userInfo <span class=\"op\">=</span> <span class=\"kw\">new</span> <span class=\"fu\">UserInfo</span><span class=\"op\">(</span>session<span class=\"op\">.</span><span class=\"fu\">getId</span><span class=\"op\">(),</span>nickName<span class=\"op\">);</span></span>\n<span id=\"cb2-32\"><a href=\"#cb2-32\" aria-hidden=\"true\" tabindex=\"-1\"></a>        connectmap<span class=\"op\">.</span><span class=\"fu\">put</span><span class=\"op\">(</span>session<span class=\"op\">,</span>userInfo<span class=\"op\">);</span></span>\n<span id=\"cb2-33\"><a href=\"#cb2-33\" aria-hidden=\"true\" tabindex=\"-1\"></a>        webSocketSet<span class=\"op\">.</span><span class=\"fu\">add</span><span class=\"op\">(</span><span class=\"kw\">this</span><span class=\"op\">);</span>     <span class=\"co\">//加入set中</span></span>\n<span id=\"cb2-34\"><a href=\"#cb2-34\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">System</span><span class=\"op\">.</span><span class=\"fu\">out</span><span class=\"op\">.</span><span class=\"fu\">println</span><span class=\"op\">(</span>nickName<span class=\"op\">+</span><span class=\"st\">&quot; 上线了！当前在线人数为&quot;</span> <span class=\"op\">+</span> webSocketSet<span class=\"op\">.</span><span class=\"fu\">size</span><span class=\"op\">());</span></span>\n<span id=\"cb2-35\"><a href=\"#cb2-35\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"co\">//群发消息，告诉每一位</span></span>\n<span id=\"cb2-36\"><a href=\"#cb2-36\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"fu\">broadcast</span><span class=\"op\">(</span>nickName<span class=\"op\">+</span><span class=\"st\">&quot; 上线了！--&gt;当前在线人数为：&quot;</span><span class=\"op\">+</span>webSocketSet<span class=\"op\">.</span><span class=\"fu\">size</span><span class=\"op\">());</span></span>\n<span id=\"cb2-37\"><a href=\"#cb2-37\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-38\"><a href=\"#cb2-38\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">/**</span></span>\n<span id=\"cb2-39\"><a href=\"#cb2-39\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">连接关闭调用的方法</span></span>\n<span id=\"cb2-40\"><a href=\"#cb2-40\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*/</span></span>\n<span id=\"cb2-41\"><a href=\"#cb2-41\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"at\">@OnClose</span></span>\n<span id=\"cb2-42\"><a href=\"#cb2-42\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">onClose</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-43\"><a href=\"#cb2-43\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">String</span> nickName<span class=\"op\">=</span>connectmap<span class=\"op\">.</span><span class=\"fu\">get</span><span class=\"op\">(</span>session<span class=\"op\">).</span><span class=\"fu\">getNickName</span><span class=\"op\">();</span></span>\n<span id=\"cb2-44\"><a href=\"#cb2-44\" aria-hidden=\"true\" tabindex=\"-1\"></a>        connectmap<span class=\"op\">.</span><span class=\"fu\">remove</span><span class=\"op\">(</span>session<span class=\"op\">);</span></span>\n<span id=\"cb2-45\"><a href=\"#cb2-45\" aria-hidden=\"true\" tabindex=\"-1\"></a>        webSocketSet<span class=\"op\">.</span><span class=\"fu\">remove</span><span class=\"op\">(</span><span class=\"kw\">this</span><span class=\"op\">);</span>  <span class=\"co\">//从set中删除</span></span>\n<span id=\"cb2-46\"><a href=\"#cb2-46\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">System</span><span class=\"op\">.</span><span class=\"fu\">out</span><span class=\"op\">.</span><span class=\"fu\">println</span><span class=\"op\">(</span>nickName<span class=\"op\">+</span><span class=\"st\">&quot; 下线了！当前在线人数为&quot;</span> <span class=\"op\">+</span> webSocketSet<span class=\"op\">.</span><span class=\"fu\">size</span><span class=\"op\">());</span></span>\n<span id=\"cb2-47\"><a href=\"#cb2-47\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"co\">//群发消息，告诉每一位</span></span>\n<span id=\"cb2-48\"><a href=\"#cb2-48\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"fu\">broadcast</span><span class=\"op\">(</span>nickName<span class=\"op\">+</span><span class=\"st\">&quot; 下线，当前在线人数为：&quot;</span><span class=\"op\">+</span>webSocketSet<span class=\"op\">.</span><span class=\"fu\">size</span><span class=\"op\">());</span></span>\n<span id=\"cb2-49\"><a href=\"#cb2-49\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-50\"><a href=\"#cb2-50\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">/**</span></span>\n<span id=\"cb2-51\"><a href=\"#cb2-51\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">收到客户端消息后调用的方法</span></span>\n<span id=\"cb2-52\"><a href=\"#cb2-52\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span></span>\n<span id=\"cb2-53\"><a href=\"#cb2-53\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\">     * @</span>param message <span class=\"co\">客户端发送过来的消息</span></span>\n<span id=\"cb2-54\"><a href=\"#cb2-54\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">*/</span></span>\n<span id=\"cb2-55\"><a href=\"#cb2-55\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"at\">@OnMessage</span></span>\n<span id=\"cb2-56\"><a href=\"#cb2-56\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">onMessage</span><span class=\"op\">(</span><span class=\"bu\">String</span> message<span class=\"op\">,</span> Session session<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-57\"><a href=\"#cb2-57\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">System</span><span class=\"op\">.</span><span class=\"fu\">out</span><span class=\"op\">.</span><span class=\"fu\">println</span><span class=\"op\">(</span><span class=\"st\">&quot;来自客户端的消息:&quot;</span> <span class=\"op\">+</span> message<span class=\"op\">);</span></span>\n<span id=\"cb2-58\"><a href=\"#cb2-58\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"co\">//群发消息</span></span>\n<span id=\"cb2-59\"><a href=\"#cb2-59\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">String</span> nickName<span class=\"op\">=</span>connectmap<span class=\"op\">.</span><span class=\"fu\">get</span><span class=\"op\">(</span>session<span class=\"op\">).</span><span class=\"fu\">getNickName</span><span class=\"op\">();</span></span>\n<span id=\"cb2-60\"><a href=\"#cb2-60\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"fu\">broadcast</span><span class=\"op\">(</span>nickName<span class=\"op\">+</span><span class=\"st\">&quot; 说：&quot;</span><span class=\"op\">+</span>message<span class=\"op\">);</span></span>\n<span id=\"cb2-61\"><a href=\"#cb2-61\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-62\"><a href=\"#cb2-62\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">/**</span></span>\n<span id=\"cb2-63\"><a href=\"#cb2-63\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">发生错误时调用</span></span>\n<span id=\"cb2-64\"><a href=\"#cb2-64\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span></span>\n<span id=\"cb2-65\"><a href=\"#cb2-65\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*/</span></span>\n<span id=\"cb2-66\"><a href=\"#cb2-66\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"at\">@OnError</span></span>\n<span id=\"cb2-67\"><a href=\"#cb2-67\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">onError</span><span class=\"op\">(</span>Session session<span class=\"op\">,</span> <span class=\"bu\">Throwable</span> error<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-68\"><a href=\"#cb2-68\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"bu\">System</span><span class=\"op\">.</span><span class=\"fu\">out</span><span class=\"op\">.</span><span class=\"fu\">println</span><span class=\"op\">(</span><span class=\"st\">&quot;发生错误&quot;</span><span class=\"op\">);</span></span>\n<span id=\"cb2-69\"><a href=\"#cb2-69\" aria-hidden=\"true\" tabindex=\"-1\"></a>        error<span class=\"op\">.</span><span class=\"fu\">printStackTrace</span><span class=\"op\">();</span></span>\n<span id=\"cb2-70\"><a href=\"#cb2-70\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-71\"><a href=\"#cb2-71\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"co\">/**</span></span>\n<span id=\"cb2-72\"><a href=\"#cb2-72\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">群发自定义消息</span></span>\n<span id=\"cb2-73\"><a href=\"#cb2-73\" aria-hidden=\"true\" tabindex=\"-1\"></a>     <span class=\"co\">*</span> <span class=\"co\">*/</span></span>\n<span id=\"cb2-74\"><a href=\"#cb2-74\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span>  <span class=\"dt\">void</span> <span class=\"fu\">broadcast</span><span class=\"op\">(</span><span class=\"bu\">String</span> message<span class=\"op\">)&#123;</span></span>\n<span id=\"cb2-75\"><a href=\"#cb2-75\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"cf\">for</span> <span class=\"op\">(</span>MyWebSocket item <span class=\"op\">:</span> webSocketSet<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb2-76\"><a href=\"#cb2-76\" aria-hidden=\"true\" tabindex=\"-1\"></a>            <span class=\"co\">//同步异步说明参考：http://blog.csdn.net/who_is_xiaoming/article/details/53287691</span></span>\n<span id=\"cb2-77\"><a href=\"#cb2-77\" aria-hidden=\"true\" tabindex=\"-1\"></a>            <span class=\"co\">//this.session.getBasicRemote().sendText(message);</span></span>\n<span id=\"cb2-78\"><a href=\"#cb2-78\" aria-hidden=\"true\" tabindex=\"-1\"></a>            item<span class=\"op\">.</span><span class=\"fu\">session</span><span class=\"op\">.</span><span class=\"fu\">getAsyncRemote</span><span class=\"op\">().</span><span class=\"fu\">sendText</span><span class=\"op\">(</span>message<span class=\"op\">);</span><span class=\"co\">//异步发送消息.</span></span>\n<span id=\"cb2-79\"><a href=\"#cb2-79\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-80\"><a href=\"#cb2-80\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb2-81\"><a href=\"#cb2-81\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"op\">&#125;</span></span></code></pre></div>\n<h2 id=\"实体类entity\">实体类Entity</h2>\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb3-1\"><a href=\"#cb3-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">public</span> <span class=\"kw\">class</span> UserInfo <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-2\"><a href=\"#cb3-2\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> <span class=\"bu\">String</span> id<span class=\"op\">;</span></span>\n<span id=\"cb3-3\"><a href=\"#cb3-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> <span class=\"bu\">String</span> nickName<span class=\"op\">;</span></span>\n<span id=\"cb3-4\"><a href=\"#cb3-4\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">private</span> <span class=\"bu\">String</span> password<span class=\"op\">;</span></span>\n<span id=\"cb3-5\"><a href=\"#cb3-5\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-6\"><a href=\"#cb3-6\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"fu\">UserInfo</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-7\"><a href=\"#cb3-7\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-8\"><a href=\"#cb3-8\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-9\"><a href=\"#cb3-9\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"fu\">UserInfo</span><span class=\"op\">(</span><span class=\"bu\">String</span> id<span class=\"op\">,</span> <span class=\"bu\">String</span> nickName<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-10\"><a href=\"#cb3-10\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">id</span> <span class=\"op\">=</span> id<span class=\"op\">;</span></span>\n<span id=\"cb3-11\"><a href=\"#cb3-11\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">nickName</span> <span class=\"op\">=</span> nickName<span class=\"op\">;</span></span>\n<span id=\"cb3-12\"><a href=\"#cb3-12\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-13\"><a href=\"#cb3-13\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-14\"><a href=\"#cb3-14\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"bu\">String</span> <span class=\"fu\">getId</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-15\"><a href=\"#cb3-15\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"cf\">return</span> id<span class=\"op\">;</span></span>\n<span id=\"cb3-16\"><a href=\"#cb3-16\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-17\"><a href=\"#cb3-17\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-18\"><a href=\"#cb3-18\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">setId</span><span class=\"op\">(</span><span class=\"bu\">String</span> id<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-19\"><a href=\"#cb3-19\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">id</span> <span class=\"op\">=</span> id<span class=\"op\">;</span></span>\n<span id=\"cb3-20\"><a href=\"#cb3-20\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-21\"><a href=\"#cb3-21\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-22\"><a href=\"#cb3-22\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"bu\">String</span> <span class=\"fu\">getNickName</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-23\"><a href=\"#cb3-23\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"cf\">return</span> nickName<span class=\"op\">;</span></span>\n<span id=\"cb3-24\"><a href=\"#cb3-24\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-25\"><a href=\"#cb3-25\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-26\"><a href=\"#cb3-26\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">setNickName</span><span class=\"op\">(</span><span class=\"bu\">String</span> nickName<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-27\"><a href=\"#cb3-27\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">nickName</span> <span class=\"op\">=</span> nickName<span class=\"op\">;</span></span>\n<span id=\"cb3-28\"><a href=\"#cb3-28\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-29\"><a href=\"#cb3-29\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-30\"><a href=\"#cb3-30\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"bu\">String</span> <span class=\"fu\">getPassword</span><span class=\"op\">()</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-31\"><a href=\"#cb3-31\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"cf\">return</span> password<span class=\"op\">;</span></span>\n<span id=\"cb3-32\"><a href=\"#cb3-32\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-33\"><a href=\"#cb3-33\" aria-hidden=\"true\" tabindex=\"-1\"></a> </span>\n<span id=\"cb3-34\"><a href=\"#cb3-34\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"kw\">public</span> <span class=\"dt\">void</span> <span class=\"fu\">setPassword</span><span class=\"op\">(</span><span class=\"bu\">String</span> password<span class=\"op\">)</span> <span class=\"op\">&#123;</span></span>\n<span id=\"cb3-35\"><a href=\"#cb3-35\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"kw\">this</span><span class=\"op\">.</span><span class=\"fu\">password</span> <span class=\"op\">=</span> password<span class=\"op\">;</span></span>\n<span id=\"cb3-36\"><a href=\"#cb3-36\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"op\">&#125;</span></span>\n<span id=\"cb3-37\"><a href=\"#cb3-37\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"op\">&#125;</span></span></code></pre></div>\n<hr>\n<h3 id=\"about-me\">About ME</h3>\n<h5 id=\"读书城南-在未来面前我们都是孩子\">👋 读书城南，🤔\n在未来面前，我们都是孩子～</h5>\n<ul>\n<li>📙\n一个热衷于探索学习新方向、新事物的智能产品经理，闲暇时间喜欢coding💻、画图🎨、音乐🎵、学习ing~</li>\n</ul>\n<h5 id=\"social-media\">👋 Social Media</h5>\n<ul>\n<li><p>🛠️ Blog: <a href=\"http://oceaneyes.top\">http://oceaneyes.top</a></p></li>\n<li><p>⚡ PM导航: <a href=\"https://pmhub.oceangzy.top\">https://pmhub.oceangzy.top</a></p></li>\n<li><p>☘️ CNBLOG: <a href=\"https://www.cnblogs.com/oceaneyes-gzy/\">https://www.cnblogs.com/oceaneyes-gzy/</a></p></li>\n<li><p>🌱 AI PRJ自己部署的一些算法demo: <a href=\"http://ai.oceangzy.top/\">http://ai.oceangzy.top/</a></p></li>\n<li><p>📫 Email: 1450136519@qq.com</p></li>\n<li><p>💬 WeChat: <a href=\"https://oceaneyes.top/img/wechatqrcode.jpg\">OCEANGZY</a></p></li>\n<li><p>💬 公众号: <a href=\"https://oceaneyes.top/img/wechatgzh.jpeg\">UncleJoker-GZY</a></p></li>\n</ul>\n<h5 id=\"加入小组\">👋 加入小组~</h5>\n<p><img src=\"https://oceaneyes.top/img/zhishigroup.jpg\" title=\"加入组织\" alt width=\"240\"></p>\n<h5 id=\"感谢打赏\">👋 感谢打赏~</h5>\n<p><img src=\"https://oceaneyes.top/img/alipay.jpg\" title=\"支付宝打赏\" alt width=\"140\">\n<img src=\"https://oceaneyes.top/img/wechatpay.jpg\" title=\"微信打赏\" alt width=\"140\"></p>\n","categories":[{"name":"Java","path":"api/categories/Java.json"},{"name":"SpringBoot","path":"api/categories/SpringBoot.json"}],"tags":[{"name":"服务端","path":"api/tags/服务端.json"},{"name":"Java","path":"api/tags/Java.json"},{"name":"SpringBoot","path":"api/tags/SpringBoot.json"},{"name":"WebSocket","path":"api/tags/WebSocket.json"}]}