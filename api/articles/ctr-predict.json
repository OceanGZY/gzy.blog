{"title":"广告投放中的CTR预估模型","slug":"ctr-predict","date":"2021-03-28T15:19:00.000Z","updated":"2022-09-30T06:56:37.166Z","comments":true,"path":"api/articles/ctr-predict.json","excerpt":null,"covers":["https://oceaneyes.top/img/zhishigroup.jpg","https://oceaneyes.top/img/alipay.jpg","https://oceaneyes.top/img/wechatpay.jpg"],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h1 id=\"广告投放中的ctr预估模型\">广告投放中的CTR预估模型</h1>\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb1-1\"><a href=\"#cb1-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> numpy <span class=\"im\">as</span> np</span>\n<span id=\"cb1-2\"><a href=\"#cb1-2\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> pandas <span class=\"im\">as</span> pd</span>\n<span id=\"cb1-3\"><a href=\"#cb1-3\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> sklearn</span>\n<span id=\"cb1-4\"><a href=\"#cb1-4\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">from</span> sklearn.model_selection <span class=\"im\">import</span> StratifiedKFold</span>\n<span id=\"cb1-5\"><a href=\"#cb1-5\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">from</span> sklearn.metrics <span class=\"im\">import</span> roc_auc_score</span>\n<span id=\"cb1-6\"><a href=\"#cb1-6\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> gc</span>\n<span id=\"cb1-7\"><a href=\"#cb1-7\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb1-8\"><a href=\"#cb1-8\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> os</span>\n<span id=\"cb1-9\"><a href=\"#cb1-9\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb1-10\"><a href=\"#cb1-10\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> lightgbm <span class=\"im\">as</span> lgb</span></code></pre></div>\n<h2 id=\"数据清洗\">数据清洗</h2>\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb2-1\"><a href=\"#cb2-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> numpy <span class=\"im\">as</span> np</span>\n<span id=\"cb2-2\"><a href=\"#cb2-2\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> pandas <span class=\"im\">as</span> pd</span>\n<span id=\"cb2-3\"><a href=\"#cb2-3\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> sklearn</span>\n<span id=\"cb2-4\"><a href=\"#cb2-4\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">from</span> sklearn.model_selection <span class=\"im\">import</span> StratifiedKFold</span>\n<span id=\"cb2-5\"><a href=\"#cb2-5\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">from</span> sklearn.metrics <span class=\"im\">import</span> roc_auc_score</span>\n<span id=\"cb2-6\"><a href=\"#cb2-6\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> gc</span>\n<span id=\"cb2-7\"><a href=\"#cb2-7\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb2-8\"><a href=\"#cb2-8\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> os</span>\n<span id=\"cb2-9\"><a href=\"#cb2-9\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb2-10\"><a href=\"#cb2-10\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> lightgbm <span class=\"im\">as</span> lgb</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb3-1\"><a href=\"#cb3-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data_path <span class=\"op\">=</span> <span class=\"st\">&#39;./datasets/&#39;</span></span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb4-1\"><a href=\"#cb4-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>train <span class=\"op\">=</span> pd.read_csv(os.path.join(data_path,<span class=\"st\">&#39;train.csv&#39;</span>))</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb5\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb5-1\"><a href=\"#cb5-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test <span class=\"op\">=</span> pd.read_csv(os.path.join(data_path,<span class=\"st\">&#39;test.csv&#39;</span>))</span></code></pre></div>\n<p>特征字段 字段描述 id 用户行为id，唯一表示，无重复 date\n行为时间，精确到秒 user_id 用户id product 产品 campaign_id 活动id\nwebpage_id 网页id product_category_id 产品类型id user_group_id\n用户所属群组id gender 性别 age_level 年龄等级 user_depth 用户价值深度\nvar_1 匿名特征 isClick 是否点击，1为点击，0为未点击</p>\n<div class=\"sourceCode\" id=\"cb6\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb6-1\"><a href=\"#cb6-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>train</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb7\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb7-1\"><a href=\"#cb7-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb8\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb8-1\"><a href=\"#cb8-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data <span class=\"op\">=</span> pd.concat([train,test],ignore_index<span class=\"op\">=</span><span class=\"va\">True</span>)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb9\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb9-1\"><a href=\"#cb9-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb10\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb10-1\"><a href=\"#cb10-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data[<span class=\"st\">&#39;day_id&#39;</span>] <span class=\"op\">=</span> data[<span class=\"st\">&#39;date&#39;</span>].<span class=\"bu\">apply</span>(<span class=\"kw\">lambda</span> x:<span class=\"bu\">int</span>(x[<span class=\"dv\">3</span>:<span class=\"dv\">5</span>]))</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb11\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb11-1\"><a href=\"#cb11-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data[<span class=\"st\">&#39;minute_id&#39;</span>]<span class=\"op\">=</span>data[<span class=\"st\">&#39;date&#39;</span>].<span class=\"bu\">apply</span>(<span class=\"kw\">lambda</span> x:<span class=\"bu\">int</span>(x[<span class=\"op\">-</span><span class=\"dv\">5</span>:<span class=\"op\">-</span><span class=\"dv\">3</span>])<span class=\"op\">*</span><span class=\"dv\">60</span> <span class=\"op\">+</span> <span class=\"bu\">int</span>(x[<span class=\"op\">-</span><span class=\"dv\">2</span>:]))</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb12\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb12-1\"><a href=\"#cb12-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data</span></code></pre></div>\n<h2 id=\"特征工程\">特征工程</h2>\n<h4 id=\"构建用户每天前后两次浏览行为之间的时间间隔及其衍生均值特征-因为用户浏览时间往往和其是否点击具有相关性\">构建用户每天前后两次浏览行为之间的时间间隔及其衍生均值特征,\n因为用户浏览时间往往和其是否点击具有相关性</h4>\n<div class=\"sourceCode\" id=\"cb13\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb13-1\"><a href=\"#cb13-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data[<span class=\"st\">&#39;minute_id&#39;</span>].shift(<span class=\"op\">-</span><span class=\"dv\">1</span>)</span></code></pre></div>\n<pre><code>0            0.0\n1            0.0\n2            0.0\n3            1.0\n4            1.0\n           ...  \n463286    1439.0\n463287    1439.0\n463288    1439.0\n463289    1439.0\n463290       NaN\nName: minute_id, Length: 463291, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb15\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb15-1\"><a href=\"#cb15-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id&#39;</span>].<span class=\"bu\">apply</span>(<span class=\"kw\">lambda</span> x :x.shift(<span class=\"op\">-</span><span class=\"dv\">1</span>) <span class=\"op\">-</span>x)</span></code></pre></div>\n<pre><code>0         NaN\n1         0.0\n2         2.0\n3         NaN\n4         NaN\n         ... \n463286    NaN\n463287    NaN\n463288    0.0\n463289    NaN\n463290    NaN\nName: minute_id, Length: 463291, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb17\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb17-1\"><a href=\"#cb17-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id&#39;</span>].agg(<span class=\"kw\">lambda</span> x :x.shift(<span class=\"op\">-</span><span class=\"dv\">1</span>) <span class=\"op\">-</span>x)</span></code></pre></div>\n<pre><code>user_id  day_id\n0        2                                              NaN\n         6                                              NaN\n1        2                                  [0.0, 2.0, nan]\n2        2                                              NaN\n         3         [0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 6.0, nan]\n                                     ...                   \n150342   7                                       [0.0, nan]\n150343   7                                              NaN\n150344   7                                              NaN\n150345   7                                              NaN\n150346   7                                       [0.0, nan]\nName: minute_id, Length: 249625, dtype: object</code></pre>\n<div class=\"sourceCode\" id=\"cb19\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb19-1\"><a href=\"#cb19-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id&#39;</span>].transform(<span class=\"kw\">lambda</span> x :x.shift(<span class=\"op\">-</span><span class=\"dv\">1</span>) <span class=\"op\">-</span>x)</span></code></pre></div>\n<pre><code>0         NaN\n1         0.0\n2         2.0\n3         NaN\n4         NaN\n         ... \n463286    NaN\n463287    NaN\n463288    0.0\n463289    NaN\n463290    NaN\nName: minute_id, Length: 463291, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb21\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb21-1\"><a href=\"#cb21-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data[<span class=\"st\">&#39;minute_id_diff&#39;</span>] <span class=\"op\">=</span> data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id&#39;</span>].transform(<span class=\"kw\">lambda</span> x :x.shift(<span class=\"op\">-</span><span class=\"dv\">1</span>) <span class=\"op\">-</span>x)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb22\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb22-1\"><a href=\"#cb22-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id_diff&#39;</span>].transform(<span class=\"st\">&#39;mean&#39;</span>)</span></code></pre></div>\n<pre><code>0           NaN\n1           1.0\n2           1.0\n3           NaN\n4           NaN\n          ...  \n463286      NaN\n463287     34.0\n463288    154.8\n463289    154.8\n463290     26.0\nName: minute_id_diff, Length: 463291, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb24\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb24-1\"><a href=\"#cb24-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id_diff&#39;</span>].agg(<span class=\"st\">&#39;mean&#39;</span>)</span></code></pre></div>\n<pre><code>user_id  day_id\n0        2              NaN\n         6              NaN\n1        2         1.000000\n2        2              NaN\n         3         1.142857\n                     ...   \n150342   7         0.000000\n150343   7              NaN\n150344   7              NaN\n150345   7              NaN\n150346   7         0.000000\nName: minute_id_diff, Length: 249625, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb26\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb26-1\"><a href=\"#cb26-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id_diff&#39;</span>].mean()</span></code></pre></div>\n<pre><code>user_id  day_id\n0        2              NaN\n         6              NaN\n1        2         1.000000\n2        2              NaN\n         3         1.142857\n                     ...   \n150342   7         0.000000\n150343   7              NaN\n150344   7              NaN\n150345   7              NaN\n150346   7         0.000000\nName: minute_id_diff, Length: 249625, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb28\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb28-1\"><a href=\"#cb28-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data[<span class=\"st\">&#39;minute_id_diff_mean&#39;</span>] <span class=\"op\">=</span> data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id_diff&#39;</span>].transform(<span class=\"st\">&#39;mean&#39;</span>)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb29\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb29-1\"><a href=\"#cb29-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"cf\">for</span> col <span class=\"kw\">in</span> [<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;product&#39;</span>,<span class=\"st\">&#39;campaign_id&#39;</span>,<span class=\"st\">&#39;webpage_id&#39;</span>,<span class=\"st\">&#39;product_category_id&#39;</span>,<span class=\"st\">&#39;user_group_id&#39;</span>]:</span>\n<span id=\"cb29-2\"><a href=\"#cb29-2\" aria-hidden=\"true\" tabindex=\"-1\"></a>    data[<span class=\"st\">&#39;</span><span class=\"sc\">&#123;&#125;</span><span class=\"st\">_count&#39;</span>.<span class=\"bu\">format</span>(col)] <span class=\"op\">=</span> data.groupby(col)[<span class=\"st\">&#39;minute_id&#39;</span>].transform(<span class=\"st\">&#39;count&#39;</span>)</span>\n<span id=\"cb29-3\"><a href=\"#cb29-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    </span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb30\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb30-1\"><a href=\"#cb30-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.columns</span></code></pre></div>\n<pre><code>Index([&#39;id&#39;, &#39;date&#39;, &#39;user_id&#39;, &#39;product&#39;, &#39;campaign_id&#39;, &#39;webpage_id&#39;,\n       &#39;product_category_id&#39;, &#39;user_group_id&#39;, &#39;gender&#39;, &#39;age_level&#39;,\n       &#39;user_depth&#39;, &#39;var_1&#39;, &#39;isClick&#39;, &#39;day_id&#39;, &#39;minute_id&#39;,\n       &#39;minute_id_diff&#39;, &#39;minute_id_diff_mean&#39;, &#39;user_id_count&#39;,\n       &#39;product_count&#39;, &#39;campaign_id_count&#39;, &#39;webpage_id_count&#39;,\n       &#39;product_category_id_count&#39;, &#39;user_group_id_count&#39;],\n      dtype=&#39;object&#39;)</code></pre>\n<div class=\"sourceCode\" id=\"cb32\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb32-1\"><a href=\"#cb32-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>ycol <span class=\"op\">=</span> <span class=\"st\">&#39;isClick&#39;</span></span>\n<span id=\"cb32-2\"><a href=\"#cb32-2\" aria-hidden=\"true\" tabindex=\"-1\"></a>drop_list <span class=\"op\">=</span> [</span>\n<span id=\"cb32-3\"><a href=\"#cb32-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    ycol,</span>\n<span id=\"cb32-4\"><a href=\"#cb32-4\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;id&#39;</span>,</span>\n<span id=\"cb32-5\"><a href=\"#cb32-5\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;date&#39;</span></span>\n<span id=\"cb32-6\"><a href=\"#cb32-6\" aria-hidden=\"true\" tabindex=\"-1\"></a>]</span>\n<span id=\"cb32-7\"><a href=\"#cb32-7\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb32-8\"><a href=\"#cb32-8\" aria-hidden=\"true\" tabindex=\"-1\"></a>features <span class=\"op\">=</span> [x <span class=\"cf\">for</span> x <span class=\"kw\">in</span> data.columns <span class=\"cf\">if</span> x <span class=\"kw\">not</span> <span class=\"kw\">in</span> drop_list]</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb33\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb33-1\"><a href=\"#cb33-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"bu\">print</span>(<span class=\"st\">&quot;使用</span><span class=\"sc\">&#123;&#125;</span><span class=\"st\"> 个特征:</span><span class=\"sc\">&#123;&#125;</span><span class=\"st\">&quot;</span>.<span class=\"bu\">format</span>(<span class=\"bu\">len</span>(features),features))</span></code></pre></div>\n<pre><code>使用20 个特征:[&#39;user_id&#39;, &#39;product&#39;, &#39;campaign_id&#39;, &#39;webpage_id&#39;, &#39;product_category_id&#39;, &#39;user_group_id&#39;, &#39;gender&#39;, &#39;age_level&#39;, &#39;user_depth&#39;, &#39;var_1&#39;, &#39;day_id&#39;, &#39;minute_id&#39;, &#39;minute_id_diff&#39;, &#39;minute_id_diff_mean&#39;, &#39;user_id_count&#39;, &#39;product_count&#39;, &#39;campaign_id_count&#39;, &#39;webpage_id_count&#39;, &#39;product_category_id_count&#39;, &#39;user_group_id_count&#39;]</code></pre>\n<div class=\"sourceCode\" id=\"cb35\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb35-1\"><a href=\"#cb35-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\"># 下列特征转化为类别特征</span></span>\n<span id=\"cb35-2\"><a href=\"#cb35-2\" aria-hidden=\"true\" tabindex=\"-1\"></a>categorical_feature <span class=\"op\">=</span> [</span>\n<span id=\"cb35-3\"><a href=\"#cb35-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;user_id&#39;</span>,</span>\n<span id=\"cb35-4\"><a href=\"#cb35-4\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;product&#39;</span>,</span>\n<span id=\"cb35-5\"><a href=\"#cb35-5\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;campaign_id&#39;</span>,</span>\n<span id=\"cb35-6\"><a href=\"#cb35-6\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;webpage_id&#39;</span>,</span>\n<span id=\"cb35-7\"><a href=\"#cb35-7\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;product_category_id&#39;</span>,</span>\n<span id=\"cb35-8\"><a href=\"#cb35-8\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;user_group_id&#39;</span>,</span>\n<span id=\"cb35-9\"><a href=\"#cb35-9\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;gender&#39;</span>,</span>\n<span id=\"cb35-10\"><a href=\"#cb35-10\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;age_level&#39;</span>,</span>\n<span id=\"cb35-11\"><a href=\"#cb35-11\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;user_depth&#39;</span>,</span>\n<span id=\"cb35-12\"><a href=\"#cb35-12\" aria-hidden=\"true\" tabindex=\"-1\"></a>]</span>\n<span id=\"cb35-13\"><a href=\"#cb35-13\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb35-14\"><a href=\"#cb35-14\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"cf\">for</span> col <span class=\"kw\">in</span> categorical_feature:</span>\n<span id=\"cb35-15\"><a href=\"#cb35-15\" aria-hidden=\"true\" tabindex=\"-1\"></a>    data[col] <span class=\"op\">=</span> data[col].astype(<span class=\"st\">&#39;category&#39;</span>)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb36\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb36-1\"><a href=\"#cb36-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>train <span class=\"op\">=</span> data[<span class=\"op\">~</span>data[ycol].isnull()]</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb37\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb37-1\"><a href=\"#cb37-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test <span class=\"op\">=</span> data[data[ycol].isnull()]</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb38\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb38-1\"><a href=\"#cb38-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>train.shape</span></code></pre></div>\n<pre><code>(391825, 23)</code></pre>\n<div class=\"sourceCode\" id=\"cb40\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb40-1\"><a href=\"#cb40-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test.shape</span></code></pre></div>\n<pre><code>(71466, 23)</code></pre>\n<div class=\"sourceCode\" id=\"cb42\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb42-1\"><a href=\"#cb42-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">del</span>(data)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb43\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb43-1\"><a href=\"#cb43-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>gc.collect()</span></code></pre></div>\n<pre><code>0</code></pre>\n<h2 id=\"五折交叉验证训练模型\">五折交叉验证训练模型</h2>\n<div class=\"sourceCode\" id=\"cb45\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb45-1\"><a href=\"#cb45-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>NFLOD <span class=\"op\">=</span><span class=\"dv\">5</span></span>\n<span id=\"cb45-2\"><a href=\"#cb45-2\" aria-hidden=\"true\" tabindex=\"-1\"></a>random_state <span class=\"op\">=</span> <span class=\"dv\">2021</span></span>\n<span id=\"cb45-3\"><a href=\"#cb45-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>KF <span class=\"op\">=</span> StratifiedKFold(n_splits <span class=\"op\">=</span> NFLOD,shuffle<span class=\"op\">=</span><span class=\"va\">True</span>,random_state<span class=\"op\">=</span>random_state)</span>\n<span id=\"cb45-4\"><a href=\"#cb45-4\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb45-5\"><a href=\"#cb45-5\" aria-hidden=\"true\" tabindex=\"-1\"></a>params_lgb <span class=\"op\">=</span> &#123;</span>\n<span id=\"cb45-6\"><a href=\"#cb45-6\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;boosting&#39;</span>:<span class=\"st\">&#39;gbdt&#39;</span>,</span>\n<span id=\"cb45-7\"><a href=\"#cb45-7\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;objective&#39;</span>:<span class=\"st\">&#39;binary&#39;</span>,</span>\n<span id=\"cb45-8\"><a href=\"#cb45-8\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;metric&#39;</span>:<span class=\"st\">&#39;auc&#39;</span>,</span>\n<span id=\"cb45-9\"><a href=\"#cb45-9\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;force_row_size&#39;</span>:<span class=\"va\">True</span>,</span>\n<span id=\"cb45-10\"><a href=\"#cb45-10\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;random_state&#39;</span>:random_state,</span>\n<span id=\"cb45-11\"><a href=\"#cb45-11\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;learning_rate&#39;</span>:<span class=\"fl\">0.03</span>,</span>\n<span id=\"cb45-12\"><a href=\"#cb45-12\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;max_depth&#39;</span>:<span class=\"dv\">8</span>,</span>\n<span id=\"cb45-13\"><a href=\"#cb45-13\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;num_leaves&#39;</span>:<span class=\"dv\">40</span>,</span>\n<span id=\"cb45-14\"><a href=\"#cb45-14\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;subsamples&#39;</span>:<span class=\"fl\">0.8</span>,</span>\n<span id=\"cb45-15\"><a href=\"#cb45-15\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;subsample_freq&#39;</span>:<span class=\"dv\">3</span>,</span>\n<span id=\"cb45-16\"><a href=\"#cb45-16\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;colsample_bytree&#39;</span>:<span class=\"fl\">0.8</span>,</span>\n<span id=\"cb45-17\"><a href=\"#cb45-17\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;n_jobs&#39;</span>:<span class=\"op\">-</span><span class=\"dv\">1</span>,</span>\n<span id=\"cb45-18\"><a href=\"#cb45-18\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;verbose&#39;</span>:<span class=\"op\">-</span><span class=\"dv\">1</span></span>\n<span id=\"cb45-19\"><a href=\"#cb45-19\" aria-hidden=\"true\" tabindex=\"-1\"></a>&#125;</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb46\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb46-1\"><a href=\"#cb46-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>oof_lgb <span class=\"op\">=</span> np.zeros(<span class=\"bu\">len</span>(train))</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb47\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb47-1\"><a href=\"#cb47-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>predictions_lgb <span class=\"op\">=</span> np.zeros(<span class=\"bu\">len</span>(test))</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb48\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb48-1\"><a href=\"#cb48-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>df_importance_list <span class=\"op\">=</span> []</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb49\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb49-1\"><a href=\"#cb49-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\"># 五折交叉验证</span></span>\n<span id=\"cb49-2\"><a href=\"#cb49-2\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"cf\">for</span> fold_,(trn_idx,val_idx) <span class=\"kw\">in</span> <span class=\"bu\">enumerate</span>(KF.split(train[features],train[ycol])):</span>\n<span id=\"cb49-3\"><a href=\"#cb49-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"bu\">print</span>(<span class=\"st\">&#39;------------fold</span><span class=\"sc\">&#123;&#125;</span><span class=\"st\">-----------&#39;</span>.<span class=\"bu\">format</span>(fold_ <span class=\"op\">+</span> <span class=\"dv\">1</span>))</span>\n<span id=\"cb49-4\"><a href=\"#cb49-4\" aria-hidden=\"true\" tabindex=\"-1\"></a>    trn_data <span class=\"op\">=</span> lgb.Dataset(train.iloc[trn_idx][features] , label<span class=\"op\">=</span>train.iloc[trn_idx][ycol])</span>\n<span id=\"cb49-5\"><a href=\"#cb49-5\" aria-hidden=\"true\" tabindex=\"-1\"></a>    val_data <span class=\"op\">=</span> lgb.Dataset(train.iloc[val_idx][features], label<span class=\"op\">=</span>train.iloc[val_idx][ycol],reference<span class=\"op\">=</span>trn_data)</span>\n<span id=\"cb49-6\"><a href=\"#cb49-6\" aria-hidden=\"true\" tabindex=\"-1\"></a>    </span>\n<span id=\"cb49-7\"><a href=\"#cb49-7\" aria-hidden=\"true\" tabindex=\"-1\"></a>    clf_lgb <span class=\"op\">=</span> lgb.train(</span>\n<span id=\"cb49-8\"><a href=\"#cb49-8\" aria-hidden=\"true\" tabindex=\"-1\"></a>        params <span class=\"op\">=</span> params_lgb,</span>\n<span id=\"cb49-9\"><a href=\"#cb49-9\" aria-hidden=\"true\" tabindex=\"-1\"></a>        train_set <span class=\"op\">=</span> trn_data,</span>\n<span id=\"cb49-10\"><a href=\"#cb49-10\" aria-hidden=\"true\" tabindex=\"-1\"></a>        valid_sets <span class=\"op\">=</span> [trn_data,val_data],</span>\n<span id=\"cb49-11\"><a href=\"#cb49-11\" aria-hidden=\"true\" tabindex=\"-1\"></a>        valid_names <span class=\"op\">=</span> (<span class=\"st\">&#39;train&#39;</span>,<span class=\"st\">&#39;val&#39;</span>),</span>\n<span id=\"cb49-12\"><a href=\"#cb49-12\" aria-hidden=\"true\" tabindex=\"-1\"></a>        num_boost_round <span class=\"op\">=</span> <span class=\"dv\">50000</span>,</span>\n<span id=\"cb49-13\"><a href=\"#cb49-13\" aria-hidden=\"true\" tabindex=\"-1\"></a>        early_stopping_rounds <span class=\"op\">=</span> <span class=\"dv\">200</span>,</span>\n<span id=\"cb49-14\"><a href=\"#cb49-14\" aria-hidden=\"true\" tabindex=\"-1\"></a>        verbose_eval <span class=\"op\">=</span> <span class=\"dv\">100</span>,</span>\n<span id=\"cb49-15\"><a href=\"#cb49-15\" aria-hidden=\"true\" tabindex=\"-1\"></a>    )</span>\n<span id=\"cb49-16\"><a href=\"#cb49-16\" aria-hidden=\"true\" tabindex=\"-1\"></a>    </span>\n<span id=\"cb49-17\"><a href=\"#cb49-17\" aria-hidden=\"true\" tabindex=\"-1\"></a>    oof_lgb[val_idx] <span class=\"op\">=</span> clf_lgb.predict(train.iloc[val_idx][features],num_iteration<span class=\"op\">=</span>clf_lgb.best_iteration)</span>\n<span id=\"cb49-18\"><a href=\"#cb49-18\" aria-hidden=\"true\" tabindex=\"-1\"></a>    predictions_lgb[:] <span class=\"op\">+=</span> (clf_lgb.predict(test[features],num_iteration <span class=\"op\">=</span> clf_lgb.best_iteration)<span class=\"op\">/</span> NFLOD)</span>\n<span id=\"cb49-19\"><a href=\"#cb49-19\" aria-hidden=\"true\" tabindex=\"-1\"></a>    </span>\n<span id=\"cb49-20\"><a href=\"#cb49-20\" aria-hidden=\"true\" tabindex=\"-1\"></a>    df_importance <span class=\"op\">=</span> pd.DataFrame(&#123;</span>\n<span id=\"cb49-21\"><a href=\"#cb49-21\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"st\">&#39;column&#39;</span>:features,</span>\n<span id=\"cb49-22\"><a href=\"#cb49-22\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"st\">&#39;importance_split&#39;</span>:clf_lgb.feature_importance(importance_type <span class=\"op\">=</span> <span class=\"st\">&#39;split&#39;</span>),</span>\n<span id=\"cb49-23\"><a href=\"#cb49-23\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"st\">&#39;importance_gain&#39;</span>:clf_lgb.feature_importance(importance_type <span class=\"op\">=</span> <span class=\"st\">&#39;gain&#39;</span>)</span>\n<span id=\"cb49-24\"><a href=\"#cb49-24\" aria-hidden=\"true\" tabindex=\"-1\"></a>    &#125;)</span>\n<span id=\"cb49-25\"><a href=\"#cb49-25\" aria-hidden=\"true\" tabindex=\"-1\"></a>    </span>\n<span id=\"cb49-26\"><a href=\"#cb49-26\" aria-hidden=\"true\" tabindex=\"-1\"></a>    df_importance_list.append(df_importance)</span></code></pre></div>\n<pre><code>------------fold1-----------\n[LightGBM] [Warning] Unknown parameter: subsamples\n[LightGBM] [Warning] Unknown parameter: force_row_size\n\n\n/Users/gaozhiyong/Documents/pyenv/pyenv3.6/lib/python3.6/site-packages/lightgbm/basic.py:1433: UserWarning: Overriding the parameters from Reference Dataset.\n  _log_warning(&#39;Overriding the parameters from Reference Dataset.&#39;)\n/Users/gaozhiyong/Documents/pyenv/pyenv3.6/lib/python3.6/site-packages/lightgbm/basic.py:1245: UserWarning: categorical_column in param dict is overridden.\n  _log_warning(&#39;&#123;&#125; in param dict is overridden.&#39;.format(cat_alias))\n\n\nTraining until validation scores don&#39;t improve for 200 rounds\n[100]   train&#39;s auc: 0.677174   val&#39;s auc: 0.628599\n[200]   train&#39;s auc: 0.690672   val&#39;s auc: 0.63003\n[300]   train&#39;s auc: 0.702212   val&#39;s auc: 0.631905\n[400]   train&#39;s auc: 0.711116   val&#39;s auc: 0.632443\n[500]   train&#39;s auc: 0.7182 val&#39;s auc: 0.632929\n[600]   train&#39;s auc: 0.725516   val&#39;s auc: 0.632789\nEarly stopping, best iteration is:\n[499]   train&#39;s auc: 0.718131   val&#39;s auc: 0.632934\n------------fold2-----------\n[LightGBM] [Warning] Unknown parameter: subsamples\n[LightGBM] [Warning] Unknown parameter: force_row_size\nTraining until validation scores don&#39;t improve for 200 rounds\n[100]   train&#39;s auc: 0.679197   val&#39;s auc: 0.620851\n[200]   train&#39;s auc: 0.693258   val&#39;s auc: 0.622213\n[300]   train&#39;s auc: 0.703885   val&#39;s auc: 0.623473\n[400]   train&#39;s auc: 0.714255   val&#39;s auc: 0.62404\n[500]   train&#39;s auc: 0.720288   val&#39;s auc: 0.624115\n[600]   train&#39;s auc: 0.726659   val&#39;s auc: 0.624428\n[700]   train&#39;s auc: 0.732689   val&#39;s auc: 0.624295\n[800]   train&#39;s auc: 0.73929    val&#39;s auc: 0.624619\n[900]   train&#39;s auc: 0.744832   val&#39;s auc: 0.624663\n[1000]  train&#39;s auc: 0.754675   val&#39;s auc: 0.62499\n[1100]  train&#39;s auc: 0.759126   val&#39;s auc: 0.624757\n[1200]  train&#39;s auc: 0.763615   val&#39;s auc: 0.62502\n[1300]  train&#39;s auc: 0.769984   val&#39;s auc: 0.624564\nEarly stopping, best iteration is:\n[1164]  train&#39;s auc: 0.761882   val&#39;s auc: 0.625101\n------------fold3-----------\n[LightGBM] [Warning] Unknown parameter: subsamples\n[LightGBM] [Warning] Unknown parameter: force_row_size\nTraining until validation scores don&#39;t improve for 200 rounds\n[100]   train&#39;s auc: 0.677937   val&#39;s auc: 0.623831\n[200]   train&#39;s auc: 0.691909   val&#39;s auc: 0.6257\n[300]   train&#39;s auc: 0.702329   val&#39;s auc: 0.626483\n[400]   train&#39;s auc: 0.712792   val&#39;s auc: 0.626889\n[500]   train&#39;s auc: 0.719476   val&#39;s auc: 0.627282\n[600]   train&#39;s auc: 0.726372   val&#39;s auc: 0.627444\n[700]   train&#39;s auc: 0.732891   val&#39;s auc: 0.627488\n[800]   train&#39;s auc: 0.739184   val&#39;s auc: 0.627696\n[900]   train&#39;s auc: 0.747272   val&#39;s auc: 0.62776\nEarly stopping, best iteration is:\n[756]   train&#39;s auc: 0.736675   val&#39;s auc: 0.627805\n------------fold4-----------\n[LightGBM] [Warning] Unknown parameter: subsamples\n[LightGBM] [Warning] Unknown parameter: force_row_size\nTraining until validation scores don&#39;t improve for 200 rounds\n[100]   train&#39;s auc: 0.678244   val&#39;s auc: 0.632375\n[200]   train&#39;s auc: 0.693808   val&#39;s auc: 0.633363\n[300]   train&#39;s auc: 0.703073   val&#39;s auc: 0.633338\n[400]   train&#39;s auc: 0.712667   val&#39;s auc: 0.633605\nEarly stopping, best iteration is:\n[212]   train&#39;s auc: 0.695547   val&#39;s auc: 0.633654\n------------fold5-----------\n[LightGBM] [Warning] Unknown parameter: subsamples\n[LightGBM] [Warning] Unknown parameter: force_row_size\nTraining until validation scores don&#39;t improve for 200 rounds\n[100]   train&#39;s auc: 0.677896   val&#39;s auc: 0.627158\n[200]   train&#39;s auc: 0.692087   val&#39;s auc: 0.628503\n[300]   train&#39;s auc: 0.701904   val&#39;s auc: 0.62927\n[400]   train&#39;s auc: 0.711159   val&#39;s auc: 0.629929\n[500]   train&#39;s auc: 0.718229   val&#39;s auc: 0.629463\n[600]   train&#39;s auc: 0.725839   val&#39;s auc: 0.629527\nEarly stopping, best iteration is:\n[401]   train&#39;s auc: 0.711302   val&#39;s auc: 0.630001</code></pre>\n<div class=\"sourceCode\" id=\"cb51\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb51-1\"><a href=\"#cb51-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>valid_auc_score <span class=\"op\">=</span> roc_auc_score(train[ycol],oof_lgb)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb52\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb52-1\"><a href=\"#cb52-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>valid_auc_score</span></code></pre></div>\n<pre><code>0.629614298701527</code></pre>\n<h2 id=\"特征重要性\">特征重要性</h2>\n<div class=\"sourceCode\" id=\"cb54\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb54-1\"><a href=\"#cb54-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>df_features_importances<span class=\"op\">=</span> pd.concat(df_importance_list)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb55\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb55-1\"><a href=\"#cb55-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>df_features_importance<span class=\"op\">=</span> df_features_importances.groupby(<span class=\"st\">&#39;column&#39;</span>).mean().reset_index()</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb56\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb56-1\"><a href=\"#cb56-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>df_features_importance</span></code></pre></div>\n<table border=\"1\" class=\"dataframe\">\n<thead>\n<tr style=\"text-align: right;\">\n<th>\n</th>\n<th>\ncolumn\n</th>\n<th>\nimportance_split\n</th>\n<th>\nimportance_gain\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>\n0\n</th>\n<td>\nage_level\n</td>\n<td>\n40.2\n</td>\n<td>\n407.363945\n</td>\n</tr>\n<tr>\n<th>\n1\n</th>\n<td>\ncampaign_id\n</td>\n<td>\n565.6\n</td>\n<td>\n17419.711442\n</td>\n</tr>\n<tr>\n<th>\n2\n</th>\n<td>\ncampaign_id_count\n</td>\n<td>\n1049.4\n</td>\n<td>\n5384.477741\n</td>\n</tr>\n<tr>\n<th>\n3\n</th>\n<td>\nday_id\n</td>\n<td>\n1194.6\n</td>\n<td>\n9639.523684\n</td>\n</tr>\n<tr>\n<th>\n4\n</th>\n<td>\ngender\n</td>\n<td>\n54.6\n</td>\n<td>\n253.445407\n</td>\n</tr>\n<tr>\n<th>\n5\n</th>\n<td>\nminute_id\n</td>\n<td>\n3935.8\n</td>\n<td>\n22181.027330\n</td>\n</tr>\n<tr>\n<th>\n6\n</th>\n<td>\nminute_id_diff\n</td>\n<td>\n3431.4\n</td>\n<td>\n23767.593485\n</td>\n</tr>\n<tr>\n<th>\n7\n</th>\n<td>\nminute_id_diff_mean\n</td>\n<td>\n3201.4\n</td>\n<td>\n21643.519522\n</td>\n</tr>\n<tr>\n<th>\n8\n</th>\n<td>\nproduct\n</td>\n<td>\n489.6\n</td>\n<td>\n6321.783218\n</td>\n</tr>\n<tr>\n<th>\n9\n</th>\n<td>\nproduct_category_id\n</td>\n<td>\n176.8\n</td>\n<td>\n2965.427346\n</td>\n</tr>\n<tr>\n<th>\n10\n</th>\n<td>\nproduct_category_id_count\n</td>\n<td>\n970.4\n</td>\n<td>\n6571.430858\n</td>\n</tr>\n<tr>\n<th>\n11\n</th>\n<td>\nproduct_count\n</td>\n<td>\n1215.4\n</td>\n<td>\n7685.000637\n</td>\n</tr>\n<tr>\n<th>\n12\n</th>\n<td>\nuser_depth\n</td>\n<td>\n151.4\n</td>\n<td>\n900.218823\n</td>\n</tr>\n<tr>\n<th>\n13\n</th>\n<td>\nuser_group_id\n</td>\n<td>\n395.0\n</td>\n<td>\n3675.279637\n</td>\n</tr>\n<tr>\n<th>\n14\n</th>\n<td>\nuser_group_id_count\n</td>\n<td>\n610.2\n</td>\n<td>\n3107.873730\n</td>\n</tr>\n<tr>\n<th>\n15\n</th>\n<td>\nuser_id\n</td>\n<td>\n3435.2\n</td>\n<td>\n67579.315769\n</td>\n</tr>\n<tr>\n<th>\n16\n</th>\n<td>\nuser_id_count\n</td>\n<td>\n2032.4\n</td>\n<td>\n31719.678195\n</td>\n</tr>\n<tr>\n<th>\n17\n</th>\n<td>\nvar_1\n</td>\n<td>\n248.8\n</td>\n<td>\n1597.959461\n</td>\n</tr>\n<tr>\n<th>\n18\n</th>\n<td>\nwebpage_id\n</td>\n<td>\n91.6\n</td>\n<td>\n2045.332514\n</td>\n</tr>\n<tr>\n<th>\n19\n</th>\n<td>\nwebpage_id_count\n</td>\n<td>\n359.8\n</td>\n<td>\n1744.924732\n</td>\n</tr>\n</tbody>\n</table>\n<div class=\"sourceCode\" id=\"cb57\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb57-1\"><a href=\"#cb57-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>df_features_importance.sort_values(<span class=\"st\">&#39;importance_gain&#39;</span>,ascending<span class=\"op\">=</span><span class=\"va\">False</span>)</span></code></pre></div>\n<table border=\"1\" class=\"dataframe\">\n<thead>\n<tr style=\"text-align: right;\">\n<th>\n</th>\n<th>\ncolumn\n</th>\n<th>\nimportance_split\n</th>\n<th>\nimportance_gain\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>\n15\n</th>\n<td>\nuser_id\n</td>\n<td>\n3435.2\n</td>\n<td>\n67579.315769\n</td>\n</tr>\n<tr>\n<th>\n16\n</th>\n<td>\nuser_id_count\n</td>\n<td>\n2032.4\n</td>\n<td>\n31719.678195\n</td>\n</tr>\n<tr>\n<th>\n6\n</th>\n<td>\nminute_id_diff\n</td>\n<td>\n3431.4\n</td>\n<td>\n23767.593485\n</td>\n</tr>\n<tr>\n<th>\n5\n</th>\n<td>\nminute_id\n</td>\n<td>\n3935.8\n</td>\n<td>\n22181.027330\n</td>\n</tr>\n<tr>\n<th>\n7\n</th>\n<td>\nminute_id_diff_mean\n</td>\n<td>\n3201.4\n</td>\n<td>\n21643.519522\n</td>\n</tr>\n<tr>\n<th>\n1\n</th>\n<td>\ncampaign_id\n</td>\n<td>\n565.6\n</td>\n<td>\n17419.711442\n</td>\n</tr>\n<tr>\n<th>\n3\n</th>\n<td>\nday_id\n</td>\n<td>\n1194.6\n</td>\n<td>\n9639.523684\n</td>\n</tr>\n<tr>\n<th>\n11\n</th>\n<td>\nproduct_count\n</td>\n<td>\n1215.4\n</td>\n<td>\n7685.000637\n</td>\n</tr>\n<tr>\n<th>\n10\n</th>\n<td>\nproduct_category_id_count\n</td>\n<td>\n970.4\n</td>\n<td>\n6571.430858\n</td>\n</tr>\n<tr>\n<th>\n8\n</th>\n<td>\nproduct\n</td>\n<td>\n489.6\n</td>\n<td>\n6321.783218\n</td>\n</tr>\n<tr>\n<th>\n2\n</th>\n<td>\ncampaign_id_count\n</td>\n<td>\n1049.4\n</td>\n<td>\n5384.477741\n</td>\n</tr>\n<tr>\n<th>\n13\n</th>\n<td>\nuser_group_id\n</td>\n<td>\n395.0\n</td>\n<td>\n3675.279637\n</td>\n</tr>\n<tr>\n<th>\n14\n</th>\n<td>\nuser_group_id_count\n</td>\n<td>\n610.2\n</td>\n<td>\n3107.873730\n</td>\n</tr>\n<tr>\n<th>\n9\n</th>\n<td>\nproduct_category_id\n</td>\n<td>\n176.8\n</td>\n<td>\n2965.427346\n</td>\n</tr>\n<tr>\n<th>\n18\n</th>\n<td>\nwebpage_id\n</td>\n<td>\n91.6\n</td>\n<td>\n2045.332514\n</td>\n</tr>\n<tr>\n<th>\n19\n</th>\n<td>\nwebpage_id_count\n</td>\n<td>\n359.8\n</td>\n<td>\n1744.924732\n</td>\n</tr>\n<tr>\n<th>\n17\n</th>\n<td>\nvar_1\n</td>\n<td>\n248.8\n</td>\n<td>\n1597.959461\n</td>\n</tr>\n<tr>\n<th>\n12\n</th>\n<td>\nuser_depth\n</td>\n<td>\n151.4\n</td>\n<td>\n900.218823\n</td>\n</tr>\n<tr>\n<th>\n0\n</th>\n<td>\nage_level\n</td>\n<td>\n40.2\n</td>\n<td>\n407.363945\n</td>\n</tr>\n<tr>\n<th>\n4\n</th>\n<td>\ngender\n</td>\n<td>\n54.6\n</td>\n<td>\n253.445407\n</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"预测\">预测</h2>\n<div class=\"sourceCode\" id=\"cb58\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb58-1\"><a href=\"#cb58-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test.head()</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb59\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb59-1\"><a href=\"#cb59-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test.columns</span></code></pre></div>\n<pre><code>Index([&#39;id&#39;, &#39;date&#39;, &#39;user_id&#39;, &#39;product&#39;, &#39;campaign_id&#39;, &#39;webpage_id&#39;,\n       &#39;product_category_id&#39;, &#39;user_group_id&#39;, &#39;gender&#39;, &#39;age_level&#39;,\n       &#39;user_depth&#39;, &#39;var_1&#39;, &#39;isClick&#39;, &#39;day_id&#39;, &#39;minute_id&#39;,\n       &#39;minute_id_diff&#39;, &#39;minute_id_diff_mean&#39;, &#39;user_id_count&#39;,\n       &#39;product_count&#39;, &#39;campaign_id_count&#39;, &#39;webpage_id_count&#39;,\n       &#39;product_category_id_count&#39;, &#39;user_group_id_count&#39;],\n      dtype=&#39;object&#39;)</code></pre>\n<div class=\"sourceCode\" id=\"cb61\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb61-1\"><a href=\"#cb61-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test.loc[:,ycol] <span class=\"op\">=</span> predictions_lgb</span></code></pre></div>\n<pre><code>/Users/gaozhiyong/Documents/pyenv/pyenv3.6/lib/python3.6/site-packages/pandas/core/indexing.py:1743: SettingWithCopyWarning: \nA value is trying to be set on a copy of a slice from a DataFrame.\nTry using .loc[row_indexer,col_indexer] = value instead\n\nSee the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n  isetter(ilocs[0], value)</code></pre>\n<div class=\"sourceCode\" id=\"cb63\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb63-1\"><a href=\"#cb63-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test.loc[:,ycol]</span></code></pre></div>\n<pre><code>391825    0.082708\n391826    0.084275\n391827    0.046645\n391828    0.050657\n391829    0.126505\n            ...   \n463286    0.079529\n463287    0.041204\n463288    0.046967\n463289    0.048984\n463290    0.078428\nName: isClick, Length: 71466, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb65\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb65-1\"><a href=\"#cb65-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test[[<span class=\"st\">&#39;id&#39;</span>,ycol]]</span></code></pre></div>\n<h2 id=\"保存预测结果\">保存预测结果</h2>\n<div class=\"sourceCode\" id=\"cb66\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb66-1\"><a href=\"#cb66-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test[[<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;product&#39;</span>,<span class=\"st\">&#39;campaign_id&#39;</span>,ycol]].to_csv(<span class=\"st\">&#39;res.csv&#39;</span>,index<span class=\"op\">=</span><span class=\"va\">False</span>)</span></code></pre></div>\n<hr>\n<h3 id=\"about-me\">About ME</h3>\n<h5 id=\"读书城南-在未来面前我们都是孩子\">👋 读书城南，🤔\n在未来面前，我们都是孩子～</h5>\n<ul>\n<li>📙\n一个热衷于探索学习新方向、新事物的智能产品经理，闲暇时间喜欢coding💻、画图🎨、音乐🎵、学习ing~</li>\n</ul>\n<h5 id=\"social-media\">👋 Social Media</h5>\n<ul>\n<li><p>🛠️ Blog: <a href=\"http://oceaneyes.top\">http://oceaneyes.top</a></p></li>\n<li><p>⚡ PM导航: <a href=\"https://pmhub.oceangzy.top\">https://pmhub.oceangzy.top</a></p></li>\n<li><p>☘️ CNBLOG: <a href=\"https://www.cnblogs.com/oceaneyes-gzy/\">https://www.cnblogs.com/oceaneyes-gzy/</a></p></li>\n<li><p>🌱 AI PRJ自己部署的一些算法demo: <a href=\"http://ai.oceangzy.top/\">http://ai.oceangzy.top/</a></p></li>\n<li><p>📫 Email: 1450136519@qq.com</p></li>\n<li><p>💬 WeChat: <a href=\"https://oceaneyes.top/img/wechatqrcode.jpg\">OCEANGZY</a></p></li>\n<li><p>💬 公众号: <a href=\"https://oceaneyes.top/img/wechatgzh.jpeg\">UncleJoker-GZY</a></p></li>\n</ul>\n<h5 id=\"加入小组\">👋 加入小组~</h5>\n<p><img src=\"https://oceaneyes.top/img/zhishigroup.jpg\" title=\"加入组织\" alt width=\"240\"></p>\n<h5 id=\"感谢打赏\">👋 感谢打赏~</h5>\n<p><img src=\"https://oceaneyes.top/img/alipay.jpg\" title=\"支付宝打赏\" alt width=\"140\">\n<img src=\"https://oceaneyes.top/img/wechatpay.jpg\" title=\"微信打赏\" alt width=\"140\"></p>\n","more":"<h1 id=\"广告投放中的ctr预估模型\">广告投放中的CTR预估模型</h1>\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb1-1\"><a href=\"#cb1-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> numpy <span class=\"im\">as</span> np</span>\n<span id=\"cb1-2\"><a href=\"#cb1-2\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> pandas <span class=\"im\">as</span> pd</span>\n<span id=\"cb1-3\"><a href=\"#cb1-3\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> sklearn</span>\n<span id=\"cb1-4\"><a href=\"#cb1-4\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">from</span> sklearn.model_selection <span class=\"im\">import</span> StratifiedKFold</span>\n<span id=\"cb1-5\"><a href=\"#cb1-5\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">from</span> sklearn.metrics <span class=\"im\">import</span> roc_auc_score</span>\n<span id=\"cb1-6\"><a href=\"#cb1-6\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> gc</span>\n<span id=\"cb1-7\"><a href=\"#cb1-7\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb1-8\"><a href=\"#cb1-8\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> os</span>\n<span id=\"cb1-9\"><a href=\"#cb1-9\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb1-10\"><a href=\"#cb1-10\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> lightgbm <span class=\"im\">as</span> lgb</span></code></pre></div>\n<h2 id=\"数据清洗\">数据清洗</h2>\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb2-1\"><a href=\"#cb2-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> numpy <span class=\"im\">as</span> np</span>\n<span id=\"cb2-2\"><a href=\"#cb2-2\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> pandas <span class=\"im\">as</span> pd</span>\n<span id=\"cb2-3\"><a href=\"#cb2-3\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> sklearn</span>\n<span id=\"cb2-4\"><a href=\"#cb2-4\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">from</span> sklearn.model_selection <span class=\"im\">import</span> StratifiedKFold</span>\n<span id=\"cb2-5\"><a href=\"#cb2-5\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">from</span> sklearn.metrics <span class=\"im\">import</span> roc_auc_score</span>\n<span id=\"cb2-6\"><a href=\"#cb2-6\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> gc</span>\n<span id=\"cb2-7\"><a href=\"#cb2-7\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb2-8\"><a href=\"#cb2-8\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> os</span>\n<span id=\"cb2-9\"><a href=\"#cb2-9\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb2-10\"><a href=\"#cb2-10\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"im\">import</span> lightgbm <span class=\"im\">as</span> lgb</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb3-1\"><a href=\"#cb3-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data_path <span class=\"op\">=</span> <span class=\"st\">&#39;./datasets/&#39;</span></span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb4-1\"><a href=\"#cb4-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>train <span class=\"op\">=</span> pd.read_csv(os.path.join(data_path,<span class=\"st\">&#39;train.csv&#39;</span>))</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb5\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb5-1\"><a href=\"#cb5-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test <span class=\"op\">=</span> pd.read_csv(os.path.join(data_path,<span class=\"st\">&#39;test.csv&#39;</span>))</span></code></pre></div>\n<p>特征字段 字段描述 id 用户行为id，唯一表示，无重复 date\n行为时间，精确到秒 user_id 用户id product 产品 campaign_id 活动id\nwebpage_id 网页id product_category_id 产品类型id user_group_id\n用户所属群组id gender 性别 age_level 年龄等级 user_depth 用户价值深度\nvar_1 匿名特征 isClick 是否点击，1为点击，0为未点击</p>\n<div class=\"sourceCode\" id=\"cb6\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb6-1\"><a href=\"#cb6-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>train</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb7\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb7-1\"><a href=\"#cb7-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb8\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb8-1\"><a href=\"#cb8-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data <span class=\"op\">=</span> pd.concat([train,test],ignore_index<span class=\"op\">=</span><span class=\"va\">True</span>)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb9\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb9-1\"><a href=\"#cb9-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb10\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb10-1\"><a href=\"#cb10-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data[<span class=\"st\">&#39;day_id&#39;</span>] <span class=\"op\">=</span> data[<span class=\"st\">&#39;date&#39;</span>].<span class=\"bu\">apply</span>(<span class=\"kw\">lambda</span> x:<span class=\"bu\">int</span>(x[<span class=\"dv\">3</span>:<span class=\"dv\">5</span>]))</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb11\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb11-1\"><a href=\"#cb11-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data[<span class=\"st\">&#39;minute_id&#39;</span>]<span class=\"op\">=</span>data[<span class=\"st\">&#39;date&#39;</span>].<span class=\"bu\">apply</span>(<span class=\"kw\">lambda</span> x:<span class=\"bu\">int</span>(x[<span class=\"op\">-</span><span class=\"dv\">5</span>:<span class=\"op\">-</span><span class=\"dv\">3</span>])<span class=\"op\">*</span><span class=\"dv\">60</span> <span class=\"op\">+</span> <span class=\"bu\">int</span>(x[<span class=\"op\">-</span><span class=\"dv\">2</span>:]))</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb12\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb12-1\"><a href=\"#cb12-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data</span></code></pre></div>\n<h2 id=\"特征工程\">特征工程</h2>\n<h4 id=\"构建用户每天前后两次浏览行为之间的时间间隔及其衍生均值特征-因为用户浏览时间往往和其是否点击具有相关性\">构建用户每天前后两次浏览行为之间的时间间隔及其衍生均值特征,\n因为用户浏览时间往往和其是否点击具有相关性</h4>\n<div class=\"sourceCode\" id=\"cb13\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb13-1\"><a href=\"#cb13-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data[<span class=\"st\">&#39;minute_id&#39;</span>].shift(<span class=\"op\">-</span><span class=\"dv\">1</span>)</span></code></pre></div>\n<pre><code>0            0.0\n1            0.0\n2            0.0\n3            1.0\n4            1.0\n           ...  \n463286    1439.0\n463287    1439.0\n463288    1439.0\n463289    1439.0\n463290       NaN\nName: minute_id, Length: 463291, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb15\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb15-1\"><a href=\"#cb15-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id&#39;</span>].<span class=\"bu\">apply</span>(<span class=\"kw\">lambda</span> x :x.shift(<span class=\"op\">-</span><span class=\"dv\">1</span>) <span class=\"op\">-</span>x)</span></code></pre></div>\n<pre><code>0         NaN\n1         0.0\n2         2.0\n3         NaN\n4         NaN\n         ... \n463286    NaN\n463287    NaN\n463288    0.0\n463289    NaN\n463290    NaN\nName: minute_id, Length: 463291, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb17\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb17-1\"><a href=\"#cb17-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id&#39;</span>].agg(<span class=\"kw\">lambda</span> x :x.shift(<span class=\"op\">-</span><span class=\"dv\">1</span>) <span class=\"op\">-</span>x)</span></code></pre></div>\n<pre><code>user_id  day_id\n0        2                                              NaN\n         6                                              NaN\n1        2                                  [0.0, 2.0, nan]\n2        2                                              NaN\n         3         [0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 6.0, nan]\n                                     ...                   \n150342   7                                       [0.0, nan]\n150343   7                                              NaN\n150344   7                                              NaN\n150345   7                                              NaN\n150346   7                                       [0.0, nan]\nName: minute_id, Length: 249625, dtype: object</code></pre>\n<div class=\"sourceCode\" id=\"cb19\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb19-1\"><a href=\"#cb19-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id&#39;</span>].transform(<span class=\"kw\">lambda</span> x :x.shift(<span class=\"op\">-</span><span class=\"dv\">1</span>) <span class=\"op\">-</span>x)</span></code></pre></div>\n<pre><code>0         NaN\n1         0.0\n2         2.0\n3         NaN\n4         NaN\n         ... \n463286    NaN\n463287    NaN\n463288    0.0\n463289    NaN\n463290    NaN\nName: minute_id, Length: 463291, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb21\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb21-1\"><a href=\"#cb21-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data[<span class=\"st\">&#39;minute_id_diff&#39;</span>] <span class=\"op\">=</span> data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id&#39;</span>].transform(<span class=\"kw\">lambda</span> x :x.shift(<span class=\"op\">-</span><span class=\"dv\">1</span>) <span class=\"op\">-</span>x)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb22\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb22-1\"><a href=\"#cb22-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id_diff&#39;</span>].transform(<span class=\"st\">&#39;mean&#39;</span>)</span></code></pre></div>\n<pre><code>0           NaN\n1           1.0\n2           1.0\n3           NaN\n4           NaN\n          ...  \n463286      NaN\n463287     34.0\n463288    154.8\n463289    154.8\n463290     26.0\nName: minute_id_diff, Length: 463291, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb24\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb24-1\"><a href=\"#cb24-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id_diff&#39;</span>].agg(<span class=\"st\">&#39;mean&#39;</span>)</span></code></pre></div>\n<pre><code>user_id  day_id\n0        2              NaN\n         6              NaN\n1        2         1.000000\n2        2              NaN\n         3         1.142857\n                     ...   \n150342   7         0.000000\n150343   7              NaN\n150344   7              NaN\n150345   7              NaN\n150346   7         0.000000\nName: minute_id_diff, Length: 249625, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb26\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb26-1\"><a href=\"#cb26-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id_diff&#39;</span>].mean()</span></code></pre></div>\n<pre><code>user_id  day_id\n0        2              NaN\n         6              NaN\n1        2         1.000000\n2        2              NaN\n         3         1.142857\n                     ...   \n150342   7         0.000000\n150343   7              NaN\n150344   7              NaN\n150345   7              NaN\n150346   7         0.000000\nName: minute_id_diff, Length: 249625, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb28\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb28-1\"><a href=\"#cb28-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data[<span class=\"st\">&#39;minute_id_diff_mean&#39;</span>] <span class=\"op\">=</span> data.groupby([<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;day_id&#39;</span>])[<span class=\"st\">&#39;minute_id_diff&#39;</span>].transform(<span class=\"st\">&#39;mean&#39;</span>)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb29\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb29-1\"><a href=\"#cb29-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"cf\">for</span> col <span class=\"kw\">in</span> [<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;product&#39;</span>,<span class=\"st\">&#39;campaign_id&#39;</span>,<span class=\"st\">&#39;webpage_id&#39;</span>,<span class=\"st\">&#39;product_category_id&#39;</span>,<span class=\"st\">&#39;user_group_id&#39;</span>]:</span>\n<span id=\"cb29-2\"><a href=\"#cb29-2\" aria-hidden=\"true\" tabindex=\"-1\"></a>    data[<span class=\"st\">&#39;</span><span class=\"sc\">&#123;&#125;</span><span class=\"st\">_count&#39;</span>.<span class=\"bu\">format</span>(col)] <span class=\"op\">=</span> data.groupby(col)[<span class=\"st\">&#39;minute_id&#39;</span>].transform(<span class=\"st\">&#39;count&#39;</span>)</span>\n<span id=\"cb29-3\"><a href=\"#cb29-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    </span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb30\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb30-1\"><a href=\"#cb30-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>data.columns</span></code></pre></div>\n<pre><code>Index([&#39;id&#39;, &#39;date&#39;, &#39;user_id&#39;, &#39;product&#39;, &#39;campaign_id&#39;, &#39;webpage_id&#39;,\n       &#39;product_category_id&#39;, &#39;user_group_id&#39;, &#39;gender&#39;, &#39;age_level&#39;,\n       &#39;user_depth&#39;, &#39;var_1&#39;, &#39;isClick&#39;, &#39;day_id&#39;, &#39;minute_id&#39;,\n       &#39;minute_id_diff&#39;, &#39;minute_id_diff_mean&#39;, &#39;user_id_count&#39;,\n       &#39;product_count&#39;, &#39;campaign_id_count&#39;, &#39;webpage_id_count&#39;,\n       &#39;product_category_id_count&#39;, &#39;user_group_id_count&#39;],\n      dtype=&#39;object&#39;)</code></pre>\n<div class=\"sourceCode\" id=\"cb32\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb32-1\"><a href=\"#cb32-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>ycol <span class=\"op\">=</span> <span class=\"st\">&#39;isClick&#39;</span></span>\n<span id=\"cb32-2\"><a href=\"#cb32-2\" aria-hidden=\"true\" tabindex=\"-1\"></a>drop_list <span class=\"op\">=</span> [</span>\n<span id=\"cb32-3\"><a href=\"#cb32-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    ycol,</span>\n<span id=\"cb32-4\"><a href=\"#cb32-4\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;id&#39;</span>,</span>\n<span id=\"cb32-5\"><a href=\"#cb32-5\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;date&#39;</span></span>\n<span id=\"cb32-6\"><a href=\"#cb32-6\" aria-hidden=\"true\" tabindex=\"-1\"></a>]</span>\n<span id=\"cb32-7\"><a href=\"#cb32-7\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb32-8\"><a href=\"#cb32-8\" aria-hidden=\"true\" tabindex=\"-1\"></a>features <span class=\"op\">=</span> [x <span class=\"cf\">for</span> x <span class=\"kw\">in</span> data.columns <span class=\"cf\">if</span> x <span class=\"kw\">not</span> <span class=\"kw\">in</span> drop_list]</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb33\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb33-1\"><a href=\"#cb33-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"bu\">print</span>(<span class=\"st\">&quot;使用</span><span class=\"sc\">&#123;&#125;</span><span class=\"st\"> 个特征:</span><span class=\"sc\">&#123;&#125;</span><span class=\"st\">&quot;</span>.<span class=\"bu\">format</span>(<span class=\"bu\">len</span>(features),features))</span></code></pre></div>\n<pre><code>使用20 个特征:[&#39;user_id&#39;, &#39;product&#39;, &#39;campaign_id&#39;, &#39;webpage_id&#39;, &#39;product_category_id&#39;, &#39;user_group_id&#39;, &#39;gender&#39;, &#39;age_level&#39;, &#39;user_depth&#39;, &#39;var_1&#39;, &#39;day_id&#39;, &#39;minute_id&#39;, &#39;minute_id_diff&#39;, &#39;minute_id_diff_mean&#39;, &#39;user_id_count&#39;, &#39;product_count&#39;, &#39;campaign_id_count&#39;, &#39;webpage_id_count&#39;, &#39;product_category_id_count&#39;, &#39;user_group_id_count&#39;]</code></pre>\n<div class=\"sourceCode\" id=\"cb35\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb35-1\"><a href=\"#cb35-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\"># 下列特征转化为类别特征</span></span>\n<span id=\"cb35-2\"><a href=\"#cb35-2\" aria-hidden=\"true\" tabindex=\"-1\"></a>categorical_feature <span class=\"op\">=</span> [</span>\n<span id=\"cb35-3\"><a href=\"#cb35-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;user_id&#39;</span>,</span>\n<span id=\"cb35-4\"><a href=\"#cb35-4\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;product&#39;</span>,</span>\n<span id=\"cb35-5\"><a href=\"#cb35-5\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;campaign_id&#39;</span>,</span>\n<span id=\"cb35-6\"><a href=\"#cb35-6\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;webpage_id&#39;</span>,</span>\n<span id=\"cb35-7\"><a href=\"#cb35-7\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;product_category_id&#39;</span>,</span>\n<span id=\"cb35-8\"><a href=\"#cb35-8\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;user_group_id&#39;</span>,</span>\n<span id=\"cb35-9\"><a href=\"#cb35-9\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;gender&#39;</span>,</span>\n<span id=\"cb35-10\"><a href=\"#cb35-10\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;age_level&#39;</span>,</span>\n<span id=\"cb35-11\"><a href=\"#cb35-11\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;user_depth&#39;</span>,</span>\n<span id=\"cb35-12\"><a href=\"#cb35-12\" aria-hidden=\"true\" tabindex=\"-1\"></a>]</span>\n<span id=\"cb35-13\"><a href=\"#cb35-13\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb35-14\"><a href=\"#cb35-14\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"cf\">for</span> col <span class=\"kw\">in</span> categorical_feature:</span>\n<span id=\"cb35-15\"><a href=\"#cb35-15\" aria-hidden=\"true\" tabindex=\"-1\"></a>    data[col] <span class=\"op\">=</span> data[col].astype(<span class=\"st\">&#39;category&#39;</span>)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb36\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb36-1\"><a href=\"#cb36-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>train <span class=\"op\">=</span> data[<span class=\"op\">~</span>data[ycol].isnull()]</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb37\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb37-1\"><a href=\"#cb37-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test <span class=\"op\">=</span> data[data[ycol].isnull()]</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb38\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb38-1\"><a href=\"#cb38-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>train.shape</span></code></pre></div>\n<pre><code>(391825, 23)</code></pre>\n<div class=\"sourceCode\" id=\"cb40\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb40-1\"><a href=\"#cb40-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test.shape</span></code></pre></div>\n<pre><code>(71466, 23)</code></pre>\n<div class=\"sourceCode\" id=\"cb42\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb42-1\"><a href=\"#cb42-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"kw\">del</span>(data)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb43\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb43-1\"><a href=\"#cb43-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>gc.collect()</span></code></pre></div>\n<pre><code>0</code></pre>\n<h2 id=\"五折交叉验证训练模型\">五折交叉验证训练模型</h2>\n<div class=\"sourceCode\" id=\"cb45\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb45-1\"><a href=\"#cb45-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>NFLOD <span class=\"op\">=</span><span class=\"dv\">5</span></span>\n<span id=\"cb45-2\"><a href=\"#cb45-2\" aria-hidden=\"true\" tabindex=\"-1\"></a>random_state <span class=\"op\">=</span> <span class=\"dv\">2021</span></span>\n<span id=\"cb45-3\"><a href=\"#cb45-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>KF <span class=\"op\">=</span> StratifiedKFold(n_splits <span class=\"op\">=</span> NFLOD,shuffle<span class=\"op\">=</span><span class=\"va\">True</span>,random_state<span class=\"op\">=</span>random_state)</span>\n<span id=\"cb45-4\"><a href=\"#cb45-4\" aria-hidden=\"true\" tabindex=\"-1\"></a></span>\n<span id=\"cb45-5\"><a href=\"#cb45-5\" aria-hidden=\"true\" tabindex=\"-1\"></a>params_lgb <span class=\"op\">=</span> &#123;</span>\n<span id=\"cb45-6\"><a href=\"#cb45-6\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;boosting&#39;</span>:<span class=\"st\">&#39;gbdt&#39;</span>,</span>\n<span id=\"cb45-7\"><a href=\"#cb45-7\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;objective&#39;</span>:<span class=\"st\">&#39;binary&#39;</span>,</span>\n<span id=\"cb45-8\"><a href=\"#cb45-8\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;metric&#39;</span>:<span class=\"st\">&#39;auc&#39;</span>,</span>\n<span id=\"cb45-9\"><a href=\"#cb45-9\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;force_row_size&#39;</span>:<span class=\"va\">True</span>,</span>\n<span id=\"cb45-10\"><a href=\"#cb45-10\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;random_state&#39;</span>:random_state,</span>\n<span id=\"cb45-11\"><a href=\"#cb45-11\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;learning_rate&#39;</span>:<span class=\"fl\">0.03</span>,</span>\n<span id=\"cb45-12\"><a href=\"#cb45-12\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;max_depth&#39;</span>:<span class=\"dv\">8</span>,</span>\n<span id=\"cb45-13\"><a href=\"#cb45-13\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;num_leaves&#39;</span>:<span class=\"dv\">40</span>,</span>\n<span id=\"cb45-14\"><a href=\"#cb45-14\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;subsamples&#39;</span>:<span class=\"fl\">0.8</span>,</span>\n<span id=\"cb45-15\"><a href=\"#cb45-15\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;subsample_freq&#39;</span>:<span class=\"dv\">3</span>,</span>\n<span id=\"cb45-16\"><a href=\"#cb45-16\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;colsample_bytree&#39;</span>:<span class=\"fl\">0.8</span>,</span>\n<span id=\"cb45-17\"><a href=\"#cb45-17\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;n_jobs&#39;</span>:<span class=\"op\">-</span><span class=\"dv\">1</span>,</span>\n<span id=\"cb45-18\"><a href=\"#cb45-18\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"st\">&#39;verbose&#39;</span>:<span class=\"op\">-</span><span class=\"dv\">1</span></span>\n<span id=\"cb45-19\"><a href=\"#cb45-19\" aria-hidden=\"true\" tabindex=\"-1\"></a>&#125;</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb46\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb46-1\"><a href=\"#cb46-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>oof_lgb <span class=\"op\">=</span> np.zeros(<span class=\"bu\">len</span>(train))</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb47\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb47-1\"><a href=\"#cb47-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>predictions_lgb <span class=\"op\">=</span> np.zeros(<span class=\"bu\">len</span>(test))</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb48\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb48-1\"><a href=\"#cb48-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>df_importance_list <span class=\"op\">=</span> []</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb49\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb49-1\"><a href=\"#cb49-1\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"co\"># 五折交叉验证</span></span>\n<span id=\"cb49-2\"><a href=\"#cb49-2\" aria-hidden=\"true\" tabindex=\"-1\"></a><span class=\"cf\">for</span> fold_,(trn_idx,val_idx) <span class=\"kw\">in</span> <span class=\"bu\">enumerate</span>(KF.split(train[features],train[ycol])):</span>\n<span id=\"cb49-3\"><a href=\"#cb49-3\" aria-hidden=\"true\" tabindex=\"-1\"></a>    <span class=\"bu\">print</span>(<span class=\"st\">&#39;------------fold</span><span class=\"sc\">&#123;&#125;</span><span class=\"st\">-----------&#39;</span>.<span class=\"bu\">format</span>(fold_ <span class=\"op\">+</span> <span class=\"dv\">1</span>))</span>\n<span id=\"cb49-4\"><a href=\"#cb49-4\" aria-hidden=\"true\" tabindex=\"-1\"></a>    trn_data <span class=\"op\">=</span> lgb.Dataset(train.iloc[trn_idx][features] , label<span class=\"op\">=</span>train.iloc[trn_idx][ycol])</span>\n<span id=\"cb49-5\"><a href=\"#cb49-5\" aria-hidden=\"true\" tabindex=\"-1\"></a>    val_data <span class=\"op\">=</span> lgb.Dataset(train.iloc[val_idx][features], label<span class=\"op\">=</span>train.iloc[val_idx][ycol],reference<span class=\"op\">=</span>trn_data)</span>\n<span id=\"cb49-6\"><a href=\"#cb49-6\" aria-hidden=\"true\" tabindex=\"-1\"></a>    </span>\n<span id=\"cb49-7\"><a href=\"#cb49-7\" aria-hidden=\"true\" tabindex=\"-1\"></a>    clf_lgb <span class=\"op\">=</span> lgb.train(</span>\n<span id=\"cb49-8\"><a href=\"#cb49-8\" aria-hidden=\"true\" tabindex=\"-1\"></a>        params <span class=\"op\">=</span> params_lgb,</span>\n<span id=\"cb49-9\"><a href=\"#cb49-9\" aria-hidden=\"true\" tabindex=\"-1\"></a>        train_set <span class=\"op\">=</span> trn_data,</span>\n<span id=\"cb49-10\"><a href=\"#cb49-10\" aria-hidden=\"true\" tabindex=\"-1\"></a>        valid_sets <span class=\"op\">=</span> [trn_data,val_data],</span>\n<span id=\"cb49-11\"><a href=\"#cb49-11\" aria-hidden=\"true\" tabindex=\"-1\"></a>        valid_names <span class=\"op\">=</span> (<span class=\"st\">&#39;train&#39;</span>,<span class=\"st\">&#39;val&#39;</span>),</span>\n<span id=\"cb49-12\"><a href=\"#cb49-12\" aria-hidden=\"true\" tabindex=\"-1\"></a>        num_boost_round <span class=\"op\">=</span> <span class=\"dv\">50000</span>,</span>\n<span id=\"cb49-13\"><a href=\"#cb49-13\" aria-hidden=\"true\" tabindex=\"-1\"></a>        early_stopping_rounds <span class=\"op\">=</span> <span class=\"dv\">200</span>,</span>\n<span id=\"cb49-14\"><a href=\"#cb49-14\" aria-hidden=\"true\" tabindex=\"-1\"></a>        verbose_eval <span class=\"op\">=</span> <span class=\"dv\">100</span>,</span>\n<span id=\"cb49-15\"><a href=\"#cb49-15\" aria-hidden=\"true\" tabindex=\"-1\"></a>    )</span>\n<span id=\"cb49-16\"><a href=\"#cb49-16\" aria-hidden=\"true\" tabindex=\"-1\"></a>    </span>\n<span id=\"cb49-17\"><a href=\"#cb49-17\" aria-hidden=\"true\" tabindex=\"-1\"></a>    oof_lgb[val_idx] <span class=\"op\">=</span> clf_lgb.predict(train.iloc[val_idx][features],num_iteration<span class=\"op\">=</span>clf_lgb.best_iteration)</span>\n<span id=\"cb49-18\"><a href=\"#cb49-18\" aria-hidden=\"true\" tabindex=\"-1\"></a>    predictions_lgb[:] <span class=\"op\">+=</span> (clf_lgb.predict(test[features],num_iteration <span class=\"op\">=</span> clf_lgb.best_iteration)<span class=\"op\">/</span> NFLOD)</span>\n<span id=\"cb49-19\"><a href=\"#cb49-19\" aria-hidden=\"true\" tabindex=\"-1\"></a>    </span>\n<span id=\"cb49-20\"><a href=\"#cb49-20\" aria-hidden=\"true\" tabindex=\"-1\"></a>    df_importance <span class=\"op\">=</span> pd.DataFrame(&#123;</span>\n<span id=\"cb49-21\"><a href=\"#cb49-21\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"st\">&#39;column&#39;</span>:features,</span>\n<span id=\"cb49-22\"><a href=\"#cb49-22\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"st\">&#39;importance_split&#39;</span>:clf_lgb.feature_importance(importance_type <span class=\"op\">=</span> <span class=\"st\">&#39;split&#39;</span>),</span>\n<span id=\"cb49-23\"><a href=\"#cb49-23\" aria-hidden=\"true\" tabindex=\"-1\"></a>        <span class=\"st\">&#39;importance_gain&#39;</span>:clf_lgb.feature_importance(importance_type <span class=\"op\">=</span> <span class=\"st\">&#39;gain&#39;</span>)</span>\n<span id=\"cb49-24\"><a href=\"#cb49-24\" aria-hidden=\"true\" tabindex=\"-1\"></a>    &#125;)</span>\n<span id=\"cb49-25\"><a href=\"#cb49-25\" aria-hidden=\"true\" tabindex=\"-1\"></a>    </span>\n<span id=\"cb49-26\"><a href=\"#cb49-26\" aria-hidden=\"true\" tabindex=\"-1\"></a>    df_importance_list.append(df_importance)</span></code></pre></div>\n<pre><code>------------fold1-----------\n[LightGBM] [Warning] Unknown parameter: subsamples\n[LightGBM] [Warning] Unknown parameter: force_row_size\n\n\n/Users/gaozhiyong/Documents/pyenv/pyenv3.6/lib/python3.6/site-packages/lightgbm/basic.py:1433: UserWarning: Overriding the parameters from Reference Dataset.\n  _log_warning(&#39;Overriding the parameters from Reference Dataset.&#39;)\n/Users/gaozhiyong/Documents/pyenv/pyenv3.6/lib/python3.6/site-packages/lightgbm/basic.py:1245: UserWarning: categorical_column in param dict is overridden.\n  _log_warning(&#39;&#123;&#125; in param dict is overridden.&#39;.format(cat_alias))\n\n\nTraining until validation scores don&#39;t improve for 200 rounds\n[100]   train&#39;s auc: 0.677174   val&#39;s auc: 0.628599\n[200]   train&#39;s auc: 0.690672   val&#39;s auc: 0.63003\n[300]   train&#39;s auc: 0.702212   val&#39;s auc: 0.631905\n[400]   train&#39;s auc: 0.711116   val&#39;s auc: 0.632443\n[500]   train&#39;s auc: 0.7182 val&#39;s auc: 0.632929\n[600]   train&#39;s auc: 0.725516   val&#39;s auc: 0.632789\nEarly stopping, best iteration is:\n[499]   train&#39;s auc: 0.718131   val&#39;s auc: 0.632934\n------------fold2-----------\n[LightGBM] [Warning] Unknown parameter: subsamples\n[LightGBM] [Warning] Unknown parameter: force_row_size\nTraining until validation scores don&#39;t improve for 200 rounds\n[100]   train&#39;s auc: 0.679197   val&#39;s auc: 0.620851\n[200]   train&#39;s auc: 0.693258   val&#39;s auc: 0.622213\n[300]   train&#39;s auc: 0.703885   val&#39;s auc: 0.623473\n[400]   train&#39;s auc: 0.714255   val&#39;s auc: 0.62404\n[500]   train&#39;s auc: 0.720288   val&#39;s auc: 0.624115\n[600]   train&#39;s auc: 0.726659   val&#39;s auc: 0.624428\n[700]   train&#39;s auc: 0.732689   val&#39;s auc: 0.624295\n[800]   train&#39;s auc: 0.73929    val&#39;s auc: 0.624619\n[900]   train&#39;s auc: 0.744832   val&#39;s auc: 0.624663\n[1000]  train&#39;s auc: 0.754675   val&#39;s auc: 0.62499\n[1100]  train&#39;s auc: 0.759126   val&#39;s auc: 0.624757\n[1200]  train&#39;s auc: 0.763615   val&#39;s auc: 0.62502\n[1300]  train&#39;s auc: 0.769984   val&#39;s auc: 0.624564\nEarly stopping, best iteration is:\n[1164]  train&#39;s auc: 0.761882   val&#39;s auc: 0.625101\n------------fold3-----------\n[LightGBM] [Warning] Unknown parameter: subsamples\n[LightGBM] [Warning] Unknown parameter: force_row_size\nTraining until validation scores don&#39;t improve for 200 rounds\n[100]   train&#39;s auc: 0.677937   val&#39;s auc: 0.623831\n[200]   train&#39;s auc: 0.691909   val&#39;s auc: 0.6257\n[300]   train&#39;s auc: 0.702329   val&#39;s auc: 0.626483\n[400]   train&#39;s auc: 0.712792   val&#39;s auc: 0.626889\n[500]   train&#39;s auc: 0.719476   val&#39;s auc: 0.627282\n[600]   train&#39;s auc: 0.726372   val&#39;s auc: 0.627444\n[700]   train&#39;s auc: 0.732891   val&#39;s auc: 0.627488\n[800]   train&#39;s auc: 0.739184   val&#39;s auc: 0.627696\n[900]   train&#39;s auc: 0.747272   val&#39;s auc: 0.62776\nEarly stopping, best iteration is:\n[756]   train&#39;s auc: 0.736675   val&#39;s auc: 0.627805\n------------fold4-----------\n[LightGBM] [Warning] Unknown parameter: subsamples\n[LightGBM] [Warning] Unknown parameter: force_row_size\nTraining until validation scores don&#39;t improve for 200 rounds\n[100]   train&#39;s auc: 0.678244   val&#39;s auc: 0.632375\n[200]   train&#39;s auc: 0.693808   val&#39;s auc: 0.633363\n[300]   train&#39;s auc: 0.703073   val&#39;s auc: 0.633338\n[400]   train&#39;s auc: 0.712667   val&#39;s auc: 0.633605\nEarly stopping, best iteration is:\n[212]   train&#39;s auc: 0.695547   val&#39;s auc: 0.633654\n------------fold5-----------\n[LightGBM] [Warning] Unknown parameter: subsamples\n[LightGBM] [Warning] Unknown parameter: force_row_size\nTraining until validation scores don&#39;t improve for 200 rounds\n[100]   train&#39;s auc: 0.677896   val&#39;s auc: 0.627158\n[200]   train&#39;s auc: 0.692087   val&#39;s auc: 0.628503\n[300]   train&#39;s auc: 0.701904   val&#39;s auc: 0.62927\n[400]   train&#39;s auc: 0.711159   val&#39;s auc: 0.629929\n[500]   train&#39;s auc: 0.718229   val&#39;s auc: 0.629463\n[600]   train&#39;s auc: 0.725839   val&#39;s auc: 0.629527\nEarly stopping, best iteration is:\n[401]   train&#39;s auc: 0.711302   val&#39;s auc: 0.630001</code></pre>\n<div class=\"sourceCode\" id=\"cb51\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb51-1\"><a href=\"#cb51-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>valid_auc_score <span class=\"op\">=</span> roc_auc_score(train[ycol],oof_lgb)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb52\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb52-1\"><a href=\"#cb52-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>valid_auc_score</span></code></pre></div>\n<pre><code>0.629614298701527</code></pre>\n<h2 id=\"特征重要性\">特征重要性</h2>\n<div class=\"sourceCode\" id=\"cb54\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb54-1\"><a href=\"#cb54-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>df_features_importances<span class=\"op\">=</span> pd.concat(df_importance_list)</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb55\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb55-1\"><a href=\"#cb55-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>df_features_importance<span class=\"op\">=</span> df_features_importances.groupby(<span class=\"st\">&#39;column&#39;</span>).mean().reset_index()</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb56\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb56-1\"><a href=\"#cb56-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>df_features_importance</span></code></pre></div>\n<table border=\"1\" class=\"dataframe\">\n<thead>\n<tr style=\"text-align: right;\">\n<th>\n</th>\n<th>\ncolumn\n</th>\n<th>\nimportance_split\n</th>\n<th>\nimportance_gain\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>\n0\n</th>\n<td>\nage_level\n</td>\n<td>\n40.2\n</td>\n<td>\n407.363945\n</td>\n</tr>\n<tr>\n<th>\n1\n</th>\n<td>\ncampaign_id\n</td>\n<td>\n565.6\n</td>\n<td>\n17419.711442\n</td>\n</tr>\n<tr>\n<th>\n2\n</th>\n<td>\ncampaign_id_count\n</td>\n<td>\n1049.4\n</td>\n<td>\n5384.477741\n</td>\n</tr>\n<tr>\n<th>\n3\n</th>\n<td>\nday_id\n</td>\n<td>\n1194.6\n</td>\n<td>\n9639.523684\n</td>\n</tr>\n<tr>\n<th>\n4\n</th>\n<td>\ngender\n</td>\n<td>\n54.6\n</td>\n<td>\n253.445407\n</td>\n</tr>\n<tr>\n<th>\n5\n</th>\n<td>\nminute_id\n</td>\n<td>\n3935.8\n</td>\n<td>\n22181.027330\n</td>\n</tr>\n<tr>\n<th>\n6\n</th>\n<td>\nminute_id_diff\n</td>\n<td>\n3431.4\n</td>\n<td>\n23767.593485\n</td>\n</tr>\n<tr>\n<th>\n7\n</th>\n<td>\nminute_id_diff_mean\n</td>\n<td>\n3201.4\n</td>\n<td>\n21643.519522\n</td>\n</tr>\n<tr>\n<th>\n8\n</th>\n<td>\nproduct\n</td>\n<td>\n489.6\n</td>\n<td>\n6321.783218\n</td>\n</tr>\n<tr>\n<th>\n9\n</th>\n<td>\nproduct_category_id\n</td>\n<td>\n176.8\n</td>\n<td>\n2965.427346\n</td>\n</tr>\n<tr>\n<th>\n10\n</th>\n<td>\nproduct_category_id_count\n</td>\n<td>\n970.4\n</td>\n<td>\n6571.430858\n</td>\n</tr>\n<tr>\n<th>\n11\n</th>\n<td>\nproduct_count\n</td>\n<td>\n1215.4\n</td>\n<td>\n7685.000637\n</td>\n</tr>\n<tr>\n<th>\n12\n</th>\n<td>\nuser_depth\n</td>\n<td>\n151.4\n</td>\n<td>\n900.218823\n</td>\n</tr>\n<tr>\n<th>\n13\n</th>\n<td>\nuser_group_id\n</td>\n<td>\n395.0\n</td>\n<td>\n3675.279637\n</td>\n</tr>\n<tr>\n<th>\n14\n</th>\n<td>\nuser_group_id_count\n</td>\n<td>\n610.2\n</td>\n<td>\n3107.873730\n</td>\n</tr>\n<tr>\n<th>\n15\n</th>\n<td>\nuser_id\n</td>\n<td>\n3435.2\n</td>\n<td>\n67579.315769\n</td>\n</tr>\n<tr>\n<th>\n16\n</th>\n<td>\nuser_id_count\n</td>\n<td>\n2032.4\n</td>\n<td>\n31719.678195\n</td>\n</tr>\n<tr>\n<th>\n17\n</th>\n<td>\nvar_1\n</td>\n<td>\n248.8\n</td>\n<td>\n1597.959461\n</td>\n</tr>\n<tr>\n<th>\n18\n</th>\n<td>\nwebpage_id\n</td>\n<td>\n91.6\n</td>\n<td>\n2045.332514\n</td>\n</tr>\n<tr>\n<th>\n19\n</th>\n<td>\nwebpage_id_count\n</td>\n<td>\n359.8\n</td>\n<td>\n1744.924732\n</td>\n</tr>\n</tbody>\n</table>\n<div class=\"sourceCode\" id=\"cb57\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb57-1\"><a href=\"#cb57-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>df_features_importance.sort_values(<span class=\"st\">&#39;importance_gain&#39;</span>,ascending<span class=\"op\">=</span><span class=\"va\">False</span>)</span></code></pre></div>\n<table border=\"1\" class=\"dataframe\">\n<thead>\n<tr style=\"text-align: right;\">\n<th>\n</th>\n<th>\ncolumn\n</th>\n<th>\nimportance_split\n</th>\n<th>\nimportance_gain\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>\n15\n</th>\n<td>\nuser_id\n</td>\n<td>\n3435.2\n</td>\n<td>\n67579.315769\n</td>\n</tr>\n<tr>\n<th>\n16\n</th>\n<td>\nuser_id_count\n</td>\n<td>\n2032.4\n</td>\n<td>\n31719.678195\n</td>\n</tr>\n<tr>\n<th>\n6\n</th>\n<td>\nminute_id_diff\n</td>\n<td>\n3431.4\n</td>\n<td>\n23767.593485\n</td>\n</tr>\n<tr>\n<th>\n5\n</th>\n<td>\nminute_id\n</td>\n<td>\n3935.8\n</td>\n<td>\n22181.027330\n</td>\n</tr>\n<tr>\n<th>\n7\n</th>\n<td>\nminute_id_diff_mean\n</td>\n<td>\n3201.4\n</td>\n<td>\n21643.519522\n</td>\n</tr>\n<tr>\n<th>\n1\n</th>\n<td>\ncampaign_id\n</td>\n<td>\n565.6\n</td>\n<td>\n17419.711442\n</td>\n</tr>\n<tr>\n<th>\n3\n</th>\n<td>\nday_id\n</td>\n<td>\n1194.6\n</td>\n<td>\n9639.523684\n</td>\n</tr>\n<tr>\n<th>\n11\n</th>\n<td>\nproduct_count\n</td>\n<td>\n1215.4\n</td>\n<td>\n7685.000637\n</td>\n</tr>\n<tr>\n<th>\n10\n</th>\n<td>\nproduct_category_id_count\n</td>\n<td>\n970.4\n</td>\n<td>\n6571.430858\n</td>\n</tr>\n<tr>\n<th>\n8\n</th>\n<td>\nproduct\n</td>\n<td>\n489.6\n</td>\n<td>\n6321.783218\n</td>\n</tr>\n<tr>\n<th>\n2\n</th>\n<td>\ncampaign_id_count\n</td>\n<td>\n1049.4\n</td>\n<td>\n5384.477741\n</td>\n</tr>\n<tr>\n<th>\n13\n</th>\n<td>\nuser_group_id\n</td>\n<td>\n395.0\n</td>\n<td>\n3675.279637\n</td>\n</tr>\n<tr>\n<th>\n14\n</th>\n<td>\nuser_group_id_count\n</td>\n<td>\n610.2\n</td>\n<td>\n3107.873730\n</td>\n</tr>\n<tr>\n<th>\n9\n</th>\n<td>\nproduct_category_id\n</td>\n<td>\n176.8\n</td>\n<td>\n2965.427346\n</td>\n</tr>\n<tr>\n<th>\n18\n</th>\n<td>\nwebpage_id\n</td>\n<td>\n91.6\n</td>\n<td>\n2045.332514\n</td>\n</tr>\n<tr>\n<th>\n19\n</th>\n<td>\nwebpage_id_count\n</td>\n<td>\n359.8\n</td>\n<td>\n1744.924732\n</td>\n</tr>\n<tr>\n<th>\n17\n</th>\n<td>\nvar_1\n</td>\n<td>\n248.8\n</td>\n<td>\n1597.959461\n</td>\n</tr>\n<tr>\n<th>\n12\n</th>\n<td>\nuser_depth\n</td>\n<td>\n151.4\n</td>\n<td>\n900.218823\n</td>\n</tr>\n<tr>\n<th>\n0\n</th>\n<td>\nage_level\n</td>\n<td>\n40.2\n</td>\n<td>\n407.363945\n</td>\n</tr>\n<tr>\n<th>\n4\n</th>\n<td>\ngender\n</td>\n<td>\n54.6\n</td>\n<td>\n253.445407\n</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"预测\">预测</h2>\n<div class=\"sourceCode\" id=\"cb58\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb58-1\"><a href=\"#cb58-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test.head()</span></code></pre></div>\n<div class=\"sourceCode\" id=\"cb59\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb59-1\"><a href=\"#cb59-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test.columns</span></code></pre></div>\n<pre><code>Index([&#39;id&#39;, &#39;date&#39;, &#39;user_id&#39;, &#39;product&#39;, &#39;campaign_id&#39;, &#39;webpage_id&#39;,\n       &#39;product_category_id&#39;, &#39;user_group_id&#39;, &#39;gender&#39;, &#39;age_level&#39;,\n       &#39;user_depth&#39;, &#39;var_1&#39;, &#39;isClick&#39;, &#39;day_id&#39;, &#39;minute_id&#39;,\n       &#39;minute_id_diff&#39;, &#39;minute_id_diff_mean&#39;, &#39;user_id_count&#39;,\n       &#39;product_count&#39;, &#39;campaign_id_count&#39;, &#39;webpage_id_count&#39;,\n       &#39;product_category_id_count&#39;, &#39;user_group_id_count&#39;],\n      dtype=&#39;object&#39;)</code></pre>\n<div class=\"sourceCode\" id=\"cb61\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb61-1\"><a href=\"#cb61-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test.loc[:,ycol] <span class=\"op\">=</span> predictions_lgb</span></code></pre></div>\n<pre><code>/Users/gaozhiyong/Documents/pyenv/pyenv3.6/lib/python3.6/site-packages/pandas/core/indexing.py:1743: SettingWithCopyWarning: \nA value is trying to be set on a copy of a slice from a DataFrame.\nTry using .loc[row_indexer,col_indexer] = value instead\n\nSee the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n  isetter(ilocs[0], value)</code></pre>\n<div class=\"sourceCode\" id=\"cb63\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb63-1\"><a href=\"#cb63-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test.loc[:,ycol]</span></code></pre></div>\n<pre><code>391825    0.082708\n391826    0.084275\n391827    0.046645\n391828    0.050657\n391829    0.126505\n            ...   \n463286    0.079529\n463287    0.041204\n463288    0.046967\n463289    0.048984\n463290    0.078428\nName: isClick, Length: 71466, dtype: float64</code></pre>\n<div class=\"sourceCode\" id=\"cb65\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb65-1\"><a href=\"#cb65-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test[[<span class=\"st\">&#39;id&#39;</span>,ycol]]</span></code></pre></div>\n<h2 id=\"保存预测结果\">保存预测结果</h2>\n<div class=\"sourceCode\" id=\"cb66\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb66-1\"><a href=\"#cb66-1\" aria-hidden=\"true\" tabindex=\"-1\"></a>test[[<span class=\"st\">&#39;user_id&#39;</span>,<span class=\"st\">&#39;product&#39;</span>,<span class=\"st\">&#39;campaign_id&#39;</span>,ycol]].to_csv(<span class=\"st\">&#39;res.csv&#39;</span>,index<span class=\"op\">=</span><span class=\"va\">False</span>)</span></code></pre></div>\n<hr>\n<h3 id=\"about-me\">About ME</h3>\n<h5 id=\"读书城南-在未来面前我们都是孩子\">👋 读书城南，🤔\n在未来面前，我们都是孩子～</h5>\n<ul>\n<li>📙\n一个热衷于探索学习新方向、新事物的智能产品经理，闲暇时间喜欢coding💻、画图🎨、音乐🎵、学习ing~</li>\n</ul>\n<h5 id=\"social-media\">👋 Social Media</h5>\n<ul>\n<li><p>🛠️ Blog: <a href=\"http://oceaneyes.top\">http://oceaneyes.top</a></p></li>\n<li><p>⚡ PM导航: <a href=\"https://pmhub.oceangzy.top\">https://pmhub.oceangzy.top</a></p></li>\n<li><p>☘️ CNBLOG: <a href=\"https://www.cnblogs.com/oceaneyes-gzy/\">https://www.cnblogs.com/oceaneyes-gzy/</a></p></li>\n<li><p>🌱 AI PRJ自己部署的一些算法demo: <a href=\"http://ai.oceangzy.top/\">http://ai.oceangzy.top/</a></p></li>\n<li><p>📫 Email: 1450136519@qq.com</p></li>\n<li><p>💬 WeChat: <a href=\"https://oceaneyes.top/img/wechatqrcode.jpg\">OCEANGZY</a></p></li>\n<li><p>💬 公众号: <a href=\"https://oceaneyes.top/img/wechatgzh.jpeg\">UncleJoker-GZY</a></p></li>\n</ul>\n<h5 id=\"加入小组\">👋 加入小组~</h5>\n<p><img src=\"https://oceaneyes.top/img/zhishigroup.jpg\" title=\"加入组织\" alt width=\"240\"></p>\n<h5 id=\"感谢打赏\">👋 感谢打赏~</h5>\n<p><img src=\"https://oceaneyes.top/img/alipay.jpg\" title=\"支付宝打赏\" alt width=\"140\">\n<img src=\"https://oceaneyes.top/img/wechatpay.jpg\" title=\"微信打赏\" alt width=\"140\"></p>\n","categories":[{"name":"Artificial Intelligence","path":"api/categories/Artificial Intelligence.json"},{"name":"Machine Learning","path":"api/categories/Machine Learning.json"},{"name":"Algorithm","path":"api/categories/Algorithm.json"}],"tags":[{"name":"Machine Learning","path":"api/tags/Machine Learning.json"},{"name":"Algorithm","path":"api/tags/Algorithm.json"},{"name":"CTR","path":"api/tags/CTR.json"}]}